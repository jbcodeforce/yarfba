<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Jerome Boyer"><link href=../ rel=prev><link href=../cloudFormation/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.33"><title>SAM - AWS Studies</title><link rel=stylesheet href=../../assets/stylesheets/main.3cba04c6.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#aws-sam-serverless-application-model class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="AWS Studies" class="md-header__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AWS Studies </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> SAM </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/yarfba.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="AWS Studies" class="md-nav__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> AWS Studies </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/yarfba.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Infrastructure </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Infrastructure </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../infra/ class=md-nav__link> <span class=md-ellipsis> EC2-others </span> </a> </li> <li class=md-nav__item> <a href=../../infra/networking/ class=md-nav__link> <span class=md-ellipsis> Networking </span> </a> </li> <li class=md-nav__item> <a href=../../infra/security/ class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> <li class=md-nav__item> <a href=../../infra/storage/ class=md-nav__link> <span class=md-ellipsis> S3-Storage </span> </a> </li> <li class=md-nav__item> <a href=../../infra/route53/ class=md-nav__link> <span class=md-ellipsis> Route 53 </span> </a> </li> <li class=md-nav__item> <a href=../../monitoring/monitoring/ class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> <li class=md-nav__item> <a href=../../monitoring/cost/ class=md-nav__link> <span class=md-ellipsis> Cost mgt </span> </a> </li> <li class=md-nav__item> <a href=../../kinesis/ class=md-nav__link> <span class=md-ellipsis> Kinesis* </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sa/well-architectured/ class=md-nav__link> <span class=md-ellipsis> Well Architectured </span> </a> </li> <li class=md-nav__item> <a href=../../sa/sol-design/ class=md-nav__link> <span class=md-ellipsis> Solution design </span> </a> </li> <li class=md-nav__item> <a href=../../sa/psa-role/ class=md-nav__link> <span class=md-ellipsis> SA </span> </a> </li> <li class=md-nav__item> <a href=../../sa/saas/ class=md-nav__link> <span class=md-ellipsis> SaaS </span> </a> </li> <li class=md-nav__item> <a href=../../sa/resiliency/ class=md-nav__link> <span class=md-ellipsis> Resiliency </span> </a> </li> <li class=md-nav__item> <a href=../../templ/ class=md-nav__link> <span class=md-ellipsis> Conduct Design session </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Analytics </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Analytics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../analytics/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../analytics/emr/ class=md-nav__link> <span class=md-ellipsis> EMR </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Data </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../data/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../data/rds/ class=md-nav__link> <span class=md-ellipsis> RDS-Aurora </span> </a> </li> <li class=md-nav__item> <a href=../../data/dynamodb/ class=md-nav__link> <span class=md-ellipsis> DynamoDB </span> </a> </li> <li class=md-nav__item> <a href=../../data/data-lake/ class=md-nav__link> <span class=md-ellipsis> Data Lake </span> </a> </li> <li class=md-nav__item> <a href=../../data/redshift/ class=md-nav__link> <span class=md-ellipsis> RedShift </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> AI-ML </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> AI-ML </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ai-ml/ class=md-nav__link> <span class=md-ellipsis> All Services </span> </a> </li> <li class=md-nav__item> <a href=../../ai-ml/sagemaker/ class=md-nav__link> <span class=md-ellipsis> SageMaker </span> </a> </li> <li class=md-nav__item> <a href=../../ai-ml/bedrock/ class=md-nav__link> <span class=md-ellipsis> Bedrock </span> </a> </li> <li class=md-nav__item> <a href=../../ai-ml/q/ class=md-nav__link> <span class=md-ellipsis> Amazon Q </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Serverless </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Serverless </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../serverless/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/lambda/ class=md-nav__link> <span class=md-ellipsis> Lambda </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/apigtw/ class=md-nav__link> <span class=md-ellipsis> API Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/ecs/ class=md-nav__link> <span class=md-ellipsis> ECS </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/eks/ class=md-nav__link> <span class=md-ellipsis> EKS </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/aws-messaging-study class=md-nav__link> <span class=md-ellipsis> Messaging </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/msk/ class=md-nav__link> <span class=md-ellipsis> MSK </span> </a> </li> <li class=md-nav__item> <a href=../../kinesis/ class=md-nav__link> <span class=md-ellipsis> Kinesis* </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/eventbridge/ class=md-nav__link> <span class=md-ellipsis> EventBridge </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/stepfct/ class=md-nav__link> <span class=md-ellipsis> Step function </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/mwaa/ class=md-nav__link> <span class=md-ellipsis> MWAA </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Playground </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Playground </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../playground/ class=md-nav__link> <span class=md-ellipsis> AWS personal labs </span> </a> </li> <li class=md-nav__item> <a href=../../playground/gettingstarted/ class=md-nav__link> <span class=md-ellipsis> Getting Started EC2 </span> </a> </li> <li class=md-nav__item> <a href=../../playground/security/ class=md-nav__link> <span class=md-ellipsis> Security-IAM demos </span> </a> </li> <li class=md-nav__item> <a href=../../playground/s3-play/ class=md-nav__link> <span class=md-ellipsis> S3 play </span> </a> </li> <li class=md-nav__item> <a href=../../playground/networking/ class=md-nav__link> <span class=md-ellipsis> Networking </span> </a> </li> <li class=md-nav__item> <a href=../../playground/rds/ class=md-nav__link> <span class=md-ellipsis> RDS </span> </a> </li> <li class=md-nav__item> <a href=../../playground/rt-data-processing/ class=md-nav__link> <span class=md-ellipsis> Data processing </span> </a> </li> <li class=md-nav__item> <a href=../../playground/spark-emr/ class=md-nav__link> <span class=md-ellipsis> Analytics on EMR </span> </a> </li> <li class=md-nav__item> <a href=../../playground/ecs/ class=md-nav__link> <span class=md-ellipsis> ECS </span> </a> </li> <li class=md-nav__item> <a href=../../playground/s3-org-billing/ class=md-nav__link> <span class=md-ellipsis> S3 storage lens </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/big-data-tenant-analytics/ class=md-nav__link> <span class=md-ellipsis> SaaS demo </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9 checked> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> Coding </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=true> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Coding </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> Practices </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> SAM </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> SAM </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#value-propositions class=md-nav__link> <span class=md-ellipsis> Value propositions </span> </a> </li> <li class=md-nav__item> <a href=#getting-started class=md-nav__link> <span class=md-ellipsis> Getting started </span> </a> <nav class=md-nav aria-label="Getting started"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#summary-of-application-development-with-sam class=md-nav__link> <span class=md-ellipsis> Summary of application development with SAM </span> </a> </li> <li class=md-nav__item> <a href=#the-sam-template class=md-nav__link> <span class=md-ellipsis> The sam template </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sam-pipelines class=md-nav__link> <span class=md-ellipsis> SAM Pipelines </span> </a> <nav class=md-nav aria-label="SAM Pipelines"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#canary-deployments class=md-nav__link> <span class=md-ellipsis> Canary deployments </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#useful-information class=md-nav__link> <span class=md-ellipsis> Useful information </span> </a> <nav class=md-nav aria-label="Useful information"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#how-to-assessment class=md-nav__link> <span class=md-ellipsis> How to / assessment </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#my-examples class=md-nav__link> <span class=md-ellipsis> My examples </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../cloudFormation/ class=md-nav__link> <span class=md-ellipsis> CloudFormation </span> </a> </li> <li class=md-nav__item> <a href=../cdk/ class=md-nav__link> <span class=md-ellipsis> CDK </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io class=md-nav__link> <span class=md-ellipsis> Return to main </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#value-propositions class=md-nav__link> <span class=md-ellipsis> Value propositions </span> </a> </li> <li class=md-nav__item> <a href=#getting-started class=md-nav__link> <span class=md-ellipsis> Getting started </span> </a> <nav class=md-nav aria-label="Getting started"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#summary-of-application-development-with-sam class=md-nav__link> <span class=md-ellipsis> Summary of application development with SAM </span> </a> </li> <li class=md-nav__item> <a href=#the-sam-template class=md-nav__link> <span class=md-ellipsis> The sam template </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sam-pipelines class=md-nav__link> <span class=md-ellipsis> SAM Pipelines </span> </a> <nav class=md-nav aria-label="SAM Pipelines"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#canary-deployments class=md-nav__link> <span class=md-ellipsis> Canary deployments </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#useful-information class=md-nav__link> <span class=md-ellipsis> Useful information </span> </a> <nav class=md-nav aria-label="Useful information"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#how-to-assessment class=md-nav__link> <span class=md-ellipsis> How to / assessment </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#my-examples class=md-nav__link> <span class=md-ellipsis> My examples </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=aws-sam-serverless-application-model><a href=https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html>AWS SAM - Serverless Application Model</a><a class=headerlink href=#aws-sam-serverless-application-model title="Permanent link">&para;</a></h1> <p>AWS SAM is an extension of AWS CloudFormation with a simpler syntax for configuring common serverless application resources such as functions, triggers, databases and APIs.</p> <p><a href=https://github.com/aws/aws-sam-cli>SAM CLI</a> is an open-source. Better to use within Cloud9 environment and <a href=https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html>install sam CLI</a>.</p> <p>SAM includes two parts:</p> <ol> <li>SAM template specification: It is an extension on top of AWS CloudFormation.</li> <li>A CLI to create new project, build and deploy, perform local debugging and testing, configure pipeline.</li> </ol> <p>Here is an example of definition of a serverless app including: AWS Lambda, API gateway with HTTP api, database in DynamoDB and then IAM permissions for those services to work together.</p> <div class=highlight><pre><span></span><code><span class=nt>AWSTemplateFormatVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2010-09-09</span>
<span class=nt>Transform</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AWS::Serverless-2016-10-31</span>
<span class=nt>Resources</span><span class=p>:</span>
<span class=w>  </span><span class=nt>getAllItemsFunction</span><span class=p>:</span>
<span class=w>    </span><span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AWS::Serverless::Function</span>
<span class=w>    </span><span class=nt>Properties</span><span class=p>:</span>
<span class=w>        </span><span class=nt>Handler</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">src/get-all-items.getAllItemsHandler</span>
<span class=w>        </span><span class=nt>Runtime</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nodejs12.x</span>
<span class=w>        </span><span class=nt>Events</span><span class=p>:</span>
<span class=w>            </span><span class=nt>Api</span><span class=p>:</span>
<span class=w>            </span><span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">HttpApi</span>
<span class=w>            </span><span class=nt>Properties</span><span class=p>:</span>
<span class=w>                </span><span class=nt>Path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class=w>                </span><span class=nt>Method</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GET</span>
<span class=w>        </span><span class=nt>Connectors</span><span class=p>:</span>
<span class=w>        </span><span class=nt>MyConn</span><span class=p>:</span>
<span class=w>            </span><span class=nt>Properties</span><span class=p>:</span>
<span class=w>            </span><span class=nt>Destination</span><span class=p>:</span>
<span class=w>            </span><span class=nt>Id</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">SampleTable</span>
<span class=w>            </span><span class=nt>Permissions</span><span class=p>:</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Read</span>
<span class=w>    </span><span class=nt>SampleTable</span><span class=p>:</span>
<span class=w>        </span><span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AWS::Serverless::SimpleTable</span>
</code></pre></div> <p>During deployment, SAM transforms and expands the SAM syntax into AWS CloudFormation syntax.</p> <p>See <a href=https://github.com/aws/aws-sam-cli-app-templates>SAM templates here</a></p> <h2 id=value-propositions>Value propositions<a class=headerlink href=#value-propositions title="Permanent link">&para;</a></h2> <ul> <li>Define the application infrastructure code as quickly, using less code.</li> <li>Manage the serverless applications through their entire development lifecycle.</li> <li>Quickly provision permissions between resources with AWS SAM connectors.</li> <li>Continuously sync local changes to the cloud as we develop.</li> <li>On top of CloudFormation or Terraform.</li> </ul> <h2 id=getting-started><a href=https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-getting-started-hello-world.html>Getting started</a><a class=headerlink href=#getting-started title="Permanent link">&para;</a></h2> <p>SAM CLI provides a Lambda-like execution environment that lets you locally build, test, and debug applications defined by SAM templates or through the AWS Cloud Development Kit (CDK).</p> <ul> <li><a href=https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install-mac.html>Install</a>, which can be summarized as:</li> </ul> <div class=highlight><pre><span></span><code>brew<span class=w> </span>install<span class=w> </span>aws-sam-cli
<span class=c1># or upgrade</span>
brew<span class=w> </span>upgrade<span class=w> </span>aws-sam-cli
sam<span class=w> </span>--version
</code></pre></div> <ul> <li><a href="https://serverlessland.com/patterns?framework=SAM">Serverlessland pattern collection.</a></li> <li><a href=https://catalog.workshops.aws/complete-aws-sam/en-US>A Complete SAM Workshop.</a></li> <li><a href=https://github.com/aws-samples/aws-sam-cli-java-examples>Java samples with SAM CLI.</a></li> </ul> <h3 id=summary-of-application-development-with-sam>Summary of application development with SAM<a class=headerlink href=#summary-of-application-development-with-sam title="Permanent link">&para;</a></h3> <p>The diagram below presents the classical app components that can be created with SAM:</p> <p><img alt src=../diagrams/apigtw-lambda.drawio.png></p> <p>The following steps presents how to get a Lambda in Python exposed with API in API Gateway.</p> <ul> <li> <p>Create a SAM project</p> <div class=highlight><pre><span></span><code><span class=c1># Create a new function using interactive mode:</span>
sam<span class=w> </span>init
<span class=c1># or using parameters: Xray tracing, CloudWatch insights, python</span>
sam<span class=w> </span>init<span class=w> </span>--name<span class=w> </span>sam-app<span class=w> </span>--runtime<span class=w> </span>python3.9<span class=w> </span>--architecture<span class=w> </span>arm64<span class=w> </span>--app-template<span class=w> </span>hello-world<span class=w> </span>--tracing<span class=w> </span>--application-insights<span class=w> </span>
<span class=c1># or using powertool so we have metrics, logging, tracing</span>
sam<span class=w> </span>init<span class=w> </span>--app-template<span class=w> </span>hello-world-powertools-python<span class=w> </span>--name<span class=w> </span>carridegenerator<span class=w> </span>--package-type<span class=w> </span>Zip<span class=w> </span>--runtime<span class=w> </span>python3.9<span class=w> </span>--no-tracing
</code></pre></div> <p><em>See the code templates in the <a href=https://github.com/aws/aws-sam-cli-app-templates>git repo</a></em>.</p> </li> <li> <p>When using container <em>Image</em> as the packaging mechanism, we need to login to ECR repo via:</p> <div class=highlight><pre><span></span><code>aws<span class=w> </span>ecr-public<span class=w> </span>get-login-password<span class=w> </span>--region<span class=w> </span>us-east-1<span class=w> </span><span class=p>|</span><span class=w> </span>docker<span class=w> </span>login<span class=w> </span>--username<span class=w> </span>AWS<span class=w> </span>--password-stdin<span class=w> </span>public.ecr.aws
</code></pre></div> </li> <li> <p>Run locally - Any code update will be refreshed. First call may take sometime to download docker image. It needs docker engine to run locally. (finch is not supported yet)</p> <div class=highlight><pre><span></span><code><span class=c1># a python app:</span>
<span class=nb>cd</span><span class=w> </span>sam-app/hello_world
pip3<span class=w> </span>install<span class=w> </span>-r<span class=w> </span>requirements.txt

<span class=nb>cd</span><span class=w> </span>..
sam<span class=w> </span><span class=nb>local</span><span class=w> </span>invoke
<span class=c1># test with input event</span>
sam<span class=w> </span><span class=nb>local</span><span class=w> </span>invoke<span class=w> </span>HelloWorldFunction<span class=w> </span>--event<span class=w> </span>events/event.json
<span class=c1># Emulate API on port 8080</span>
sam<span class=w> </span><span class=nb>local</span><span class=w> </span>start-api<span class=w> </span>--port<span class=w> </span><span class=m>8080</span>
curl<span class=w> </span>http://localhost:8080/hello
</code></pre></div> </li> <li> <p>Run unit tests</p> <div class=highlight><pre><span></span><code><span class=c1># under sam-app</span>
pip3<span class=w> </span>install<span class=w> </span>pytest<span class=w> </span>pytest-mock
python3<span class=w> </span>-m<span class=w> </span>pytest<span class=w> </span>tests/unit
</code></pre></div> </li> <li> <p>Build the packaging for AWS</p> <div class=highlight><pre><span></span><code><span class=c1># under sam-app</span>
sam<span class=w> </span>build
<span class=c1># see .aws-sam folder</span>
<span class=c1># Build with Image on Mac</span>
<span class=nv>DOCKER_HOST</span><span class=o>=</span>unix://<span class=nv>$HOME</span>/.docker/run/docker.sock<span class=w> </span>sam<span class=w> </span>build<span class=w> </span>--use-container
<span class=c1># Build on linux</span>
sam<span class=w> </span>build<span class=w> </span>--use-container
</code></pre></div> </li> <li> <p>Deploy (be sure to get aws cli 'configured' with access key and secret). It is creating the resources (Lambda function, API Gateway and IAM roles)</p> <div class=highlight><pre><span></span><code><span class=c1># under sam-app</span>
sam<span class=w> </span>deploy<span class=w> </span>--guided
</code></pre></div> <p><em>The code is zipped and uploaded to a s3 bucket: <code>aws-sam-cli-managed-default-samclisourcebucket-...</code></em></p> <div class=highlight><pre><span></span><code><span class=c1># deploy with parameters</span>
<span class=nb>export</span><span class=w> </span><span class=nv>AWS_REGION</span><span class=o>=</span><span class=k>$(</span>aws<span class=w> </span>--profile<span class=w> </span>default<span class=w> </span>configure<span class=w> </span>get<span class=w> </span>region<span class=k>)</span>
sam<span class=w> </span>deploy<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--stack-name<span class=w> </span>wild-rydes-async-msg-1<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--capabilities<span class=w> </span>CAPABILITY_IAM<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--region<span class=w> </span><span class=nv>$AWS_REGION</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span>--guided
</code></pre></div> <details class="- info"> <summary>Deployment Output</summary> <p>A cloud formation template is created which includes Role, and API Gateway so the Lambda is accessible via REST API. <div class=highlight><pre><span></span><code>CloudFormation<span class=w> </span>stack<span class=w> </span>changeset
----------------------------------------------------------------------------------------------------------------------------
Operation<span class=w>                                    </span>LogicalResourceId<span class=w>                            </span>ResourceType<span class=w>                                                                 </span>
----------------------------------------------------------------------------------------------------------------------------
+<span class=w> </span>Add<span class=w>                                        </span>ApplicationInsightsMonitoring<span class=w>                </span>AWS::ApplicationInsights::Application<span class=w>                                               </span>
+<span class=w> </span>Add<span class=w>                                        </span>ApplicationResourceGroup<span class=w>                     </span>AWS::ResourceGroups::Group<span class=w>                   </span>
+<span class=w> </span>Add<span class=w>                                        </span>HelloWorldFunctionHelloWorldPermissionProd<span class=w>   </span>AWS::Lambda::Permission<span class=w>                                                           </span>
+<span class=w> </span>Add<span class=w>                                        </span>HelloWorldFunctionRole<span class=w>                       </span>AWS::IAM::Role<span class=w>                                                                     </span>
+<span class=w> </span>Add<span class=w>                                        </span>HelloWorldFunction<span class=w>                           </span>AWS::Lambda::Function<span class=w>                                                               </span>
+<span class=w> </span>Add<span class=w>                                        </span>ServerlessRestApiDeployment47fc2d5f9d<span class=w>        </span>AWS::ApiGateway::Deployment<span class=w>                                                        </span>
+<span class=w> </span>Add<span class=w>                                        </span>ServerlessRestApiProdStage<span class=w>                   </span>AWS::ApiGateway::Stage<span class=w>                                                            </span>
+<span class=w> </span>Add<span class=w>                                        </span>ServerlessRestApi<span class=w>                            </span>AWS::ApiGateway::RestApi<span class=w>                                                           </span>
-------------------------------------------------------------------------------------------------------------------------
</code></pre></div></p> </details> </li> <li> <p>[Optional] We can continuously synchronize local change to the cloud:</p> <div class=highlight><pre><span></span><code><span class=c1># look at all changes</span>
sam<span class=w> </span>sync<span class=w> </span>--watch
<span class=c1># look to code only updates</span>
sam<span class=w> </span>sync<span class=w> </span>--watch<span class=w> </span>--code
</code></pre></div> <p>The <code>sam sync</code> command can also synchronize code changes to the cloud without updating the infrastructure. This code synchronization uses the service APIs and bypasses <code>CloudFormation</code>, allowing AWS SAM to update the code in seconds instead of minutes.</p> </li> <li> <p>To clean up, we have two choices:</p> <div class=highlight><pre><span></span><code>aws<span class=w> </span>cloudformation<span class=w> </span>delete-stack<span class=w> </span>--stack-name<span class=w> </span>sam-app<span class=w> </span>--region<span class=w> </span>us-west-2
<span class=c1># with sam</span>
sam<span class=w> </span>delete
</code></pre></div> </li> <li> <p>For building a CodePipeline using <code>sam cli</code> see <a href=#sam-pipelines>next section</a>.</p> </li> </ul> <h3 id=the-sam-template>The sam template<a class=headerlink href=#the-sam-template title="Permanent link">&para;</a></h3> <p>For the function section of the template, see the <a href=https://github.com/aws/serverless-application-model/blob/master/versions/2016-10-31.md#awsserverlessfunction>lambda reference</a>.</p> <h2 id=sam-pipelines>SAM Pipelines<a class=headerlink href=#sam-pipelines title="Permanent link">&para;</a></h2> <p>AWS SAM Pipelines makes it easier to create CI/CD <a href=https://aws.amazon.com/blogs/compute/introducing-aws-sam-pipelines-automatically-generate-deployment-pipelines-for-serverless-applications/ >pipelines.</a></p> <ul> <li>Create a CodeCommit repository with something like (if needed see <a href=https://docs.aws.amazon.com/codecommit/latest/userguide/auth-and-access-control.html>codecommit authentication</a>):</li> </ul> <div class=highlight><pre><span></span><code>aws<span class=w> </span>codecommit<span class=w> </span>create-reposiory<span class=w> </span>--repository-name<span class=w> </span>sam-app
<span class=c1># if needed install python library to access code commit</span>
pip3<span class=w> </span>install<span class=w> </span>git-remote-codecommit
</code></pre></div> <ul> <li>Be sure to add .aws-sam and samconfig.yaml in .gitignore</li> </ul> <div class=highlight><pre><span></span><code><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;\n\n.aws-sam&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>.gitignore
<span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;samconfig.toml&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>.gitignore
</code></pre></div> <ul> <li>To commit change use remote URL like:</li> </ul> <div class=highlight><pre><span></span><code>git<span class=w> </span>remote<span class=w> </span>add<span class=w> </span>origin<span class=w> </span>codecommit://sam-app
</code></pre></div> <ul> <li>Create pipeline resources: </li> </ul> <p><code>sam pipeline init --bootstrap</code> command creates the AWS resources and permissions required to deploy application artifacts from our code repository into our AWS environments.</p> <p>An Amazon S3 bucket is required to store application build artifacts during the deployment process. </p> <p>Pipelines defines two stages, dev and production.</p> <p>A <code>.gitlab-ci.yml</code> pipeline file is generated. The file contains a number of environment variables, which reference the details from AWS SAM pipeline bootstrap command.</p> <p>The Cloud Formation template deploy two stacks and all the needed elements for the CI/CD in dev and prod envs. Going to Code Pipeline console to see the create pipeline.</p> <p>To create a github and git action pipeline see <a href=https://catalog.workshops.aws/complete-aws-sam/en-US/module-4-cicd/module-4-cicd-gh>this doc.</a>.</p> <h3 id=canary-deployments>Canary deployments<a class=headerlink href=#canary-deployments title="Permanent link">&para;</a></h3> <p>Technique to slowly rolling out the changes to a small subset of users before rolling it out to the entire customer base.</p> <p>AWS Lambda allows us to publish multiple versions of the same function. Each version has its own code and associated dependencies, as well as its own function settings.</p> <h2 id=useful-information>Useful information<a class=headerlink href=#useful-information title="Permanent link">&para;</a></h2> <ul> <li>The <a href=https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-specification-template-anatomy.html>template anatomy documentation</a> goes over the template structure. A must read.</li> <li><a href=https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-specification-template-anatomy.html#template-anatomy-outline.yaml>Yaml template elements</a></li> <li><a href=https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-specification-resources-and-properties.html>Resources and property ref</a></li> <li><a href=https://catalog.workshops.aws/complete-aws-sam/en-US>SAM Workshop</a>.</li> <li><a href=https://catalog.us-east-1.prod.workshops.aws/workshops/841ce16b-9d86-48ac-a3f6-6a1b29f95d2b/ >Workshop: Serverless Task App with SAM and Amplify</a> with git repo <a href=https://github.com/aws-samples/serverless-tasks-webapp>serverless-tasks-webapp</a>.</li> </ul> <h3 id=how-to-assessment>How to / assessment<a class=headerlink href=#how-to-assessment title="Permanent link">&para;</a></h3> <details class=question open=open> <summary>Difference between SAM template and CloudFormation</summary> <p>SAM template is an abstraction above CloudFormation (<code>Transform: AWS::Serverless-2016-10-31</code>) but it reuses cloud formation templates for IaC in the "resources" section. It includes a "Global section" to define properties that are common to all your serverless functions and APIs. <a href=https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-specification-template-anatomy.html>Product doc</a></p> </details> <details class="- question"> <summary>How to create and validate a SAM template?</summary> <p>Use CLI: </p> <div class=highlight><pre><span></span><code>sam<span class=w> </span>init<span class=w> </span>-h
sam<span class=w> </span>init<span class=w> </span>--runtime<span class=w> </span>python3.9<span class=w> </span>--dependency-manager<span class=w> </span>pip<span class=w> </span>--app-template<span class=w> </span>hello-world<span class=w> </span>--name<span class=w> </span>sam-app
sam<span class=w> </span>validate
</code></pre></div> </details> <details class="- question"> <summary>Invoke function locally with SAM CLI</summary> <div class=highlight><pre><span></span><code>sam<span class=w> </span><span class=nb>local</span><span class=w> </span>invoke<span class=w> </span>-e<span class=w> </span>./event.json
</code></pre></div> </details> <details class="- question"> <summary>Declare an API Gateway</summary> <div class=highlight><pre><span></span><code><span class=nt>RestAPI</span><span class=p>:</span>
<span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AWS::Serverless::Api</span>
<span class=nt>Properties</span><span class=p>:</span>
<span class=w>  </span><span class=nt>StageName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Prod</span>
<span class=w>  </span><span class=nt>TracingEnabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>  </span><span class=nt>Tags</span><span class=p>:</span>
<span class=w>    </span><span class=nt>Name</span><span class=p>:</span><span class=w> </span><span class=kt>!Sub</span><span class=w> </span><span class=s>&quot;${AWS::StackName}-API&quot;</span>
<span class=w>    </span><span class=nt>Stack</span><span class=p>:</span><span class=w> </span><span class=kt>!Sub</span><span class=w> </span><span class=s>&quot;${AWS::StackName}&quot;</span><span class=w> </span>
</code></pre></div> </details> <details class="- question"> <summary>Run API Gateway locally with SAM CLI</summary> <div class=highlight><pre><span></span><code>sam<span class=w> </span><span class=nb>local</span><span class=w> </span>start-api<span class=w> </span>--port<span class=w> </span><span class=m>8080</span>
</code></pre></div> </details> <details class="- question"> <summary>Package and deploy an application with SAM CLI</summary> <div class=highlight><pre><span></span><code>sam<span class=w> </span>build
sam<span class=w> </span>deploy<span class=w> </span>--guided
</code></pre></div> </details> <details class="- question"> <summary>Familiar with security best practices and how to leverage SAM policies when working with other services</summary> <p>To invoke a Lambda, from external service, we need to define <a href=https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-policy-templates.html>resource policies</a>. For example a Step function calling a Lambda <div class=highlight><pre><span></span><code><span class=w> </span><span class=nt>ProcessFormStateMachineExpressSync</span><span class=p>:</span>
<span class=w>    </span><span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AWS::Serverless::StateMachine</span>
<span class=w>     </span><span class="l l-Scalar l-Scalar-Plain">Properties</span><span class="p p-Indicator">:</span>
<span class=w>        </span><span class=nt>Policies</span><span class=p>:</span><span class=w>  </span>
<span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>LambdaInvokePolicy</span><span class=p>:</span>
<span class=w>                </span><span class=nt>FunctionName</span><span class=p>:</span><span class=w> </span><span class=kt>!Ref</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">FunctionNameDeclareAbove</span>
</code></pre></div></p> <p>For the function to call a AWS service we need to define execution policy:</p> <div class=highlight><pre><span></span><code><span class=w>  </span><span class=nt>OrderPublisher</span><span class=p>:</span>
<span class=w>    </span><span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AWS::Serverless::Function</span>
<span class=w>    </span><span class=nt>Properties</span><span class=p>:</span>
<span class=w>    </span><span class=nt>FunctionName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">OrderPublisher</span>
<span class=w>    </span><span class=nt>Handler</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">com.example.OrderPublisher::handleRequest</span>
<span class=w>    </span><span class=nt>CodeUri</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">target/sourceCode.zip</span>
<span class=w>    </span><span class=nt>Policies</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>DynamoDBCrudPolicy</span><span class=p>:</span>
<span class=w>            </span><span class=nt>TableName</span><span class=p>:</span><span class=w> </span><span class=kt>!Ref</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">OrdersDDBTable</span>
</code></pre></div> </details> <details class="- question"> <summary>Build, package a Lambda Layer and/or Lambda Extension</summary> <p><a href=https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html>Lambda layer</a> helps to reuse dependencies. Layers are uploaded as zip within S3 bucket. Content is in the <code>/opt</code> of the EC2 runner. This is the same process as function. <div class=highlight><pre><span></span><code>aws<span class=w> </span>lambda<span class=w> </span>publish-layer-version<span class=w> </span>--layer-name<span class=w> </span>my-layer<span class=w> </span>--description<span class=w> </span><span class=s2>&quot;My layer&quot;</span><span class=w> </span><span class=se>\</span>
--license-info<span class=w> </span><span class=s2>&quot;MIT&quot;</span><span class=w> </span>--zip-file<span class=w> </span>fileb://layer.zip<span class=w> </span><span class=se>\</span>
--compatible-runtimes<span class=w> </span>python3.11<span class=w> </span>--compatible-architectures<span class=w> </span><span class=s2>&quot;arm64&quot;</span><span class=w> </span><span class=s2>&quot;x86_64&quot;</span>
</code></pre></div></p> <p>A layer can be shared with other AWS account via command like:</p> <div class=highlight><pre><span></span><code>aws<span class=w> </span>lambda<span class=w> </span>add-layer-version-permission<span class=w> </span>--layer-name<span class=w> </span>my-layer<span class=w> </span>--statement-id<span class=w> </span>xaccount<span class=w> </span>--action<span class=w> </span>lambda:GetLayerVersion<span class=w>  </span>--principal<span class=w> </span><span class=m>111122223333</span><span class=w> </span>--version-number<span class=w> </span><span class=m>1</span><span class=w> </span>
</code></pre></div> </details> <details class="- question"> <summary>To use a Layer or Extension</summary> <p>Add the declaration in the function declaration in the sam template like: <div class=highlight><pre><span></span><code><span class=w>   </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">Layers</span><span class="p p-Indicator">:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=kt>!Ref</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">libs</span>
<span class=nt>libs</span><span class=p>:</span>
<span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AWS::Lambda::LayerVersion</span>
<span class=nt>Properties</span><span class=p>:</span>
<span class=w>  </span><span class=nt>LayerName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-layer</span>
<span class=w>  </span><span class=nt>Description</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Dependencies for the blank sample app.</span>
<span class=w>  </span><span class=nt>Content</span><span class=p>:</span>
<span class=w>    </span><span class=nt>S3Bucket</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-bucket-region-123456789012</span>
<span class=w>    </span><span class=nt>S3Key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">layer.zip</span>
<span class=w>  </span><span class=nt>CompatibleRuntimes</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">python3.11</span>
</code></pre></div></p> </details> <details class="- question"> <summary>Implement AWS Step Functions workflow using SAM</summary> <p>There are multiple sources of template in the <a href=https://github.com/aws-samples/serverless-patterns/ >serverless-patterns github repo</a>. New project can be created by using one of the Multiple Step function choices.</p> </details> <details class="- question"> <summary>Able to describe developer workflows</summary> <p>Start by creating a sam project, and then run locally to test the function code locally. Add unit test, package, and deploy to AWS account.</p> </details> <details class="- question"> <summary>Familiar with AWS CDK and integration with SAM CLI</summary> <p>We can use <a href=https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-cdk-getting-started.html>SAM within a CDK project</a>. In summary we do:</p> <ul> <li>create CDK app: <code>cdk init app --language python</code></li> <li>Add lambda declaration in the CDK stack</li> <li>Implement the lambda function</li> <li>Test locally using SAM CLI and the Stack generated by CDK: <div class=highlight><pre><span></span><code>cdk<span class=w> </span>synth<span class=w> </span>--no-staging
sam<span class=w> </span><span class=nb>local</span><span class=w> </span>invoke<span class=w> </span>MyFunction<span class=w> </span>--no-event<span class=w> </span>-t<span class=w> </span>./cdk.out/CdkSamExampleStack.template.json
</code></pre></div></li> <li>Build using SAM <div class=highlight><pre><span></span><code>sam<span class=w> </span>build<span class=w> </span>-t<span class=w> </span>./cdk.out/Stackname.template.json
</code></pre></div></li> <li>Deploy via <code>cdk deploy</code></li> </ul> </details> <details class="- question"> <summary>How to use and deploy SAM Pipelines</summary> <div class=highlight><pre><span></span><code>sam<span class=w> </span>pipeline<span class=w> </span>init<span class=w> </span>--bootstrap
</code></pre></div> </details> <details class="- question"> <summary>How to perform canary release or other safe deployment with SAM</summary> <p>We can use canary deployment for different Lambda function version by using alias traffic shifting. Need to add the following within the function declaration in SAM template: <div class=highlight><pre><span></span><code><span class=nt>AutoPublishAlias</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">live</span>
<span class=nt>DeploymentPreference</span><span class=p>:</span>
<span class=w>    </span><span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Canary10Percent5Minutes</span>
</code></pre></div></p> <p>Another type is the linear strategy: <code>Linear10PercentEvery3Minutes</code>. When using pipeline and CodeDeploy, it is possible to see the canary release in action and CodeDeploy can be configured to roll-back if there is an issue coming from CloudWatch alarm.</p> </details> <details class="- question"> <summary>Deep understanding of debugging and testing strategies with SAM</summary> <p><a href=https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/accelerate.html>AWS SAM Accelerate</a> (<code>sam sync --watch</code>) enables developers to test their code quickly against production AWS services in the cloud and avoid <code>sam deploy</code> with CF deployment. </p> </details> <details class="- question"> <summary>Use environment variables</summary> <p>Declaring an environment variables for a function, and to get the code from an external python script. The Function is also using a policy to be able to CRUD on the DynamoDB table.</p> <div class=highlight><pre><span></span><code><span class=nt>UsersFunction</span><span class=p>:</span>
<span class=w>    </span><span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AWS::Serverless::Function</span>
<span class=w>    </span><span class=nt>Properties</span><span class=p>:</span>
<span class=w>      </span><span class=nt>Handler</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">src/api/users.lambda_handler</span>
<span class=w>      </span><span class=nt>Description</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Handler for all users related operations</span>
<span class=w>      </span><span class=nt>Environment</span><span class=p>:</span>
<span class=w>        </span><span class=nt>Variables</span><span class=p>:</span>
<span class=w>          </span><span class=nt>USERS_TABLE</span><span class=p>:</span><span class=w> </span><span class=kt>!Ref</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">UsersTable</span>
<span class=w>      </span><span class=nt>Policies</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>DynamoDBCrudPolicy</span><span class=p>:</span>
<span class=w>            </span><span class=nt>TableName</span><span class=p>:</span><span class=w> </span><span class=kt>!Ref</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">UsersTable</span>
<span class=w>      </span><span class=nt>Tags</span><span class=p>:</span>
<span class=w>        </span><span class=nt>Stack</span><span class=p>:</span><span class=w> </span><span class=kt>!Sub</span><span class=w> </span><span class=s>&quot;${AWS::StackName}&quot;</span>
</code></pre></div> </details> <details class="- question"> <summary>Enabling X-Ray tracing</summary> <p>Add <code>TracingEnabled: true</code> properties</p> </details> <details class="- question"> <summary>Add REST API definition for a function</summary> <p>Add the following events declaration in the Lambda function (which will be in the triggers view in Lambda console). <div class=highlight><pre><span></span><code><span class=nt>Events</span><span class=p>:</span>
<span class=w>    </span><span class=nt>GetUsersEvent</span><span class=p>:</span>
<span class=w>      </span><span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Api</span>
<span class=w>      </span><span class=nt>Properties</span><span class=p>:</span>
<span class=w>        </span><span class=nt>Path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/users</span>
<span class=w>        </span><span class=nt>Method</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">get</span>
<span class=w>        </span><span class=nt>RestApiId</span><span class=p>:</span><span class=w> </span><span class=kt>!Ref</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">RestAPI</span>
<span class=w>    </span><span class=nt>PutUserEvent</span><span class=p>:</span>
<span class=w>      </span><span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Api</span>
<span class=w>      </span><span class=nt>Properties</span><span class=p>:</span>
<span class=w>        </span><span class=nt>Path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/users</span>
<span class=w>        </span><span class=nt>Method</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">put</span>
<span class=w>        </span><span class=nt>RestApiId</span><span class=p>:</span><span class=w> </span><span class=kt>!Ref</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">RestAPI</span>
<span class=w>    </span><span class=nt>UpdateUserEvent</span><span class=p>:</span>
<span class=w>      </span><span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Api</span>
<span class=w>      </span><span class=nt>Properties</span><span class=p>:</span>
<span class=w>        </span><span class=nt>Path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/users/{userid}</span>
<span class=w>        </span><span class=nt>Method</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">put</span>
<span class=w>        </span><span class=nt>RestApiId</span><span class=p>:</span><span class=w> </span><span class=kt>!Ref</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">RestAPI</span>
<span class=w>    </span><span class=nt>GetUserEvent</span><span class=p>:</span>
<span class=w>      </span><span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Api</span>
<span class=w>      </span><span class=nt>Properties</span><span class=p>:</span>
<span class=w>        </span><span class=nt>Path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/users/{userid}</span>
<span class=w>        </span><span class=nt>Method</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">get</span>
<span class=w>        </span><span class=nt>RestApiId</span><span class=p>:</span><span class=w> </span><span class=kt>!Ref</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">RestAPI</span>
<span class=w>    </span><span class=nt>DeleteUserEvent</span><span class=p>:</span>
<span class=w>      </span><span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Api</span>
<span class=w>      </span><span class=nt>Properties</span><span class=p>:</span>
<span class=w>        </span><span class=nt>Path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/users/{userid}</span>
<span class=w>        </span><span class=nt>Method</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">delete</span>
<span class=w>        </span><span class=nt>RestApiId</span><span class=p>:</span><span class=w> </span><span class=kt>!Ref</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">RestAPI</span>
</code></pre></div></p> </details> <details class="- question"> <summary>Add Cognito User Pool</summary> <div class=highlight><pre><span></span><code><span class=nt>UserPool</span><span class=p>:</span>
<span class=nt>Type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AWS::Cognito::UserPool</span>
<span class=nt>Properties</span><span class=p>:</span><span class=w> </span>
<span class=w>  </span><span class=nt>UserPoolName</span><span class=p>:</span><span class=w> </span><span class=kt>!Sub</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${AWS::StackName}-UserPool</span>
<span class=w>  </span><span class=nt>AdminCreateUserConfig</span><span class=p>:</span><span class=w> </span>
<span class=w>    </span><span class=nt>AllowAdminCreateUserOnly</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=w>  </span><span class=nt>AutoVerifiedAttributes</span><span class=p>:</span><span class=w> </span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">email</span>
<span class=w>  </span><span class=nt>Schema</span><span class=p>:</span><span class=w> </span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>Name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">name</span>
<span class=w>      </span><span class=nt>AttributeDataType</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">String</span>
<span class=w>      </span><span class=nt>Mutable</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>      </span><span class=nt>Required</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>Name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">email</span>
<span class=w>      </span><span class=nt>AttributeDataType</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">String</span>
<span class=w>      </span><span class=nt>Mutable</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>      </span><span class=nt>Required</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>  </span><span class=nt>UsernameAttributes</span><span class=p>:</span><span class=w> </span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">email</span>
<span class=w>  </span><span class=nt>UserPoolTags</span><span class=p>:</span>
<span class=w>      </span><span class=nt>Key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Name</span>
<span class=w>      </span><span class=nt>Value</span><span class=p>:</span><span class=w> </span><span class=kt>!Sub</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${AWS::StackName} User Pool</span>
</code></pre></div> </details> <details class="- question"> <summary>Specify a s3_bucket to upload code</summary> <p>add s3_bucket in sam</p> <div class=highlight><pre><span></span><code>
</code></pre></div> </details> <h2 id=my-examples>My examples<a class=headerlink href=#my-examples title="Permanent link">&para;</a></h2> <ul> <li><a href=https://github.com/jbcodeforce/from-git-to-slack-serverless>Repo to illustrate Getting GitHub events to API gtw, Lambda and Slack in Python</a></li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../ class="md-footer__link md-footer__link--prev" aria-label="Previous: Practices"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Practices </div> </div> </a> <a href=../cloudFormation/ class="md-footer__link md-footer__link--next" aria-label="Next: CloudFormation"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> CloudFormation </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.code.copy", "content.tooltips", "navigation.instant", "navigation.tracking", "navigation.footer", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.af256bd8.min.js></script> </body> </html>