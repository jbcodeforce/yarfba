<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Jerome Boyer"><link href=../well-architectured/ rel=prev><link href=../psa-role/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.33"><title>Solution design - AWS Studies</title><link rel=stylesheet href=../../assets/stylesheets/main.3cba04c6.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#solution-design-fun-with-aws-services class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="AWS Studies" class="md-header__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AWS Studies </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Solution design </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/yarfba.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="AWS Studies" class="md-nav__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> AWS Studies </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/yarfba.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Infrastructure </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Infrastructure </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../infra/ class=md-nav__link> <span class=md-ellipsis> EC2-others </span> </a> </li> <li class=md-nav__item> <a href=../../infra/networking/ class=md-nav__link> <span class=md-ellipsis> Networking </span> </a> </li> <li class=md-nav__item> <a href=../../infra/security/ class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> <li class=md-nav__item> <a href=../../infra/storage/ class=md-nav__link> <span class=md-ellipsis> S3-Storage </span> </a> </li> <li class=md-nav__item> <a href=../../infra/route53/ class=md-nav__link> <span class=md-ellipsis> Route 53 </span> </a> </li> <li class=md-nav__item> <a href=../../monitoring/monitoring/ class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> <li class=md-nav__item> <a href=../../monitoring/cost/ class=md-nav__link> <span class=md-ellipsis> Cost mgt </span> </a> </li> <li class=md-nav__item> <a href=../../kinesis/ class=md-nav__link> <span class=md-ellipsis> Kinesis* </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../well-architectured/ class=md-nav__link> <span class=md-ellipsis> Well Architectured </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Solution design </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Solution design </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#migration class=md-nav__link> <span class=md-ellipsis> Migration </span> </a> <nav class=md-nav aria-label=Migration> <ul class=md-nav__list> <li class=md-nav__item> <a href=#migrate-an-old-not-maintained-app class=md-nav__link> <span class=md-ellipsis> Migrate an old not maintained app </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#networking class=md-nav__link> <span class=md-ellipsis> Networking </span> </a> <nav class=md-nav aria-label=Networking> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hybrid-integration-with-2-aws-regions class=md-nav__link> <span class=md-ellipsis> Hybrid integration with 2 AWS regions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security class=md-nav__link> <span class=md-ellipsis> Security </span> </a> <nav class=md-nav aria-label=Security> <ul class=md-nav__list> <li class=md-nav__item> <a href=#use-identity-center-user-to-perform-aws-cli class=md-nav__link> <span class=md-ellipsis> Use Identity Center user to perform AWS CLI </span> </a> </li> <li class=md-nav__item> <a href=#blocking-an-ip-address class=md-nav__link> <span class=md-ellipsis> Blocking an IP address </span> </a> </li> <li class=md-nav__item> <a href=#using-identity-federation class=md-nav__link> <span class=md-ellipsis> Using identity federation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#stateless-with-persistence-app class=md-nav__link> <span class=md-ellipsis> Stateless with persistence app </span> </a> <nav class=md-nav aria-label="Stateless with persistence app"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#how-to-change-an-ec2-instance-type-while-the-host-runs-a-webapp-without-impacting-client-apps class=md-nav__link> <span class=md-ellipsis> How to change an EC2 instance type, while the host runs a webapp, without impacting client apps? </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#stateful-app class=md-nav__link> <span class=md-ellipsis> Stateful app </span> </a> </li> <li class=md-nav__item> <a href=#sharing-images class=md-nav__link> <span class=md-ellipsis> Sharing images </span> </a> </li> <li class=md-nav__item> <a href=#disaster-recovery-solution class=md-nav__link> <span class=md-ellipsis> Disaster Recovery Solution </span> </a> <nav class=md-nav aria-label="Disaster Recovery Solution"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#backup-multi-regions class=md-nav__link> <span class=md-ellipsis> Backup multi-regions </span> </a> </li> <li class=md-nav__item> <a href=#warm-region class=md-nav__link> <span class=md-ellipsis> Warm region </span> </a> </li> <li class=md-nav__item> <a href=#active-active-between-multi-regions class=md-nav__link> <span class=md-ellipsis> Active - Active between multi regions </span> </a> </li> <li class=md-nav__item> <a href=#aws-services-supporting-ha-and-dr-multi-regions class=md-nav__link> <span class=md-ellipsis> AWS Services supporting HA and DR multi-regions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#saas-deployment-for-an-isv class=md-nav__link> <span class=md-ellipsis> SaaS deployment for an ISV </span> </a> </li> <li class=md-nav__item> <a href=#a-question-of-caching class=md-nav__link> <span class=md-ellipsis> A question of caching </span> </a> </li> <li class=md-nav__item> <a href=#amazon-codedeploy-demonstration class=md-nav__link> <span class=md-ellipsis> Amazon CodeDeploy Demonstration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../psa-role/ class=md-nav__link> <span class=md-ellipsis> SA </span> </a> </li> <li class=md-nav__item> <a href=../saas/ class=md-nav__link> <span class=md-ellipsis> SaaS </span> </a> </li> <li class=md-nav__item> <a href=../resiliency/ class=md-nav__link> <span class=md-ellipsis> Resiliency </span> </a> </li> <li class=md-nav__item> <a href=../../templ/ class=md-nav__link> <span class=md-ellipsis> Conduct Design session </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Analytics </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Analytics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../analytics/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../analytics/emr/ class=md-nav__link> <span class=md-ellipsis> EMR </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Data </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../data/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../data/rds/ class=md-nav__link> <span class=md-ellipsis> RDS-Aurora </span> </a> </li> <li class=md-nav__item> <a href=../../data/dynamodb/ class=md-nav__link> <span class=md-ellipsis> DynamoDB </span> </a> </li> <li class=md-nav__item> <a href=../../data/data-lake/ class=md-nav__link> <span class=md-ellipsis> Data Lake </span> </a> </li> <li class=md-nav__item> <a href=../../data/redshift/ class=md-nav__link> <span class=md-ellipsis> RedShift </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> AI-ML </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> AI-ML </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ai-ml/ class=md-nav__link> <span class=md-ellipsis> All Services </span> </a> </li> <li class=md-nav__item> <a href=../../ai-ml/sagemaker/ class=md-nav__link> <span class=md-ellipsis> SageMaker </span> </a> </li> <li class=md-nav__item> <a href=../../ai-ml/bedrock/ class=md-nav__link> <span class=md-ellipsis> Bedrock </span> </a> </li> <li class=md-nav__item> <a href=../../ai-ml/q/ class=md-nav__link> <span class=md-ellipsis> Amazon Q </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Serverless </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Serverless </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../serverless/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/lambda/ class=md-nav__link> <span class=md-ellipsis> Lambda </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/apigtw/ class=md-nav__link> <span class=md-ellipsis> API Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/ecs/ class=md-nav__link> <span class=md-ellipsis> ECS </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/eks/ class=md-nav__link> <span class=md-ellipsis> EKS </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/aws-messaging-study class=md-nav__link> <span class=md-ellipsis> Messaging </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/msk/ class=md-nav__link> <span class=md-ellipsis> MSK </span> </a> </li> <li class=md-nav__item> <a href=../../kinesis/ class=md-nav__link> <span class=md-ellipsis> Kinesis* </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/eventbridge/ class=md-nav__link> <span class=md-ellipsis> EventBridge </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/stepfct/ class=md-nav__link> <span class=md-ellipsis> Step function </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/mwaa/ class=md-nav__link> <span class=md-ellipsis> MWAA </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Playground </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Playground </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../playground/ class=md-nav__link> <span class=md-ellipsis> AWS personal labs </span> </a> </li> <li class=md-nav__item> <a href=../../playground/gettingstarted/ class=md-nav__link> <span class=md-ellipsis> Getting Started EC2 </span> </a> </li> <li class=md-nav__item> <a href=../../playground/security/ class=md-nav__link> <span class=md-ellipsis> Security-IAM demos </span> </a> </li> <li class=md-nav__item> <a href=../../playground/s3-play/ class=md-nav__link> <span class=md-ellipsis> S3 play </span> </a> </li> <li class=md-nav__item> <a href=../../playground/networking/ class=md-nav__link> <span class=md-ellipsis> Networking </span> </a> </li> <li class=md-nav__item> <a href=../../playground/rds/ class=md-nav__link> <span class=md-ellipsis> RDS </span> </a> </li> <li class=md-nav__item> <a href=../../playground/rt-data-processing/ class=md-nav__link> <span class=md-ellipsis> Data processing </span> </a> </li> <li class=md-nav__item> <a href=../../playground/spark-emr/ class=md-nav__link> <span class=md-ellipsis> Analytics on EMR </span> </a> </li> <li class=md-nav__item> <a href=../../playground/ecs/ class=md-nav__link> <span class=md-ellipsis> ECS </span> </a> </li> <li class=md-nav__item> <a href=../../playground/s3-org-billing/ class=md-nav__link> <span class=md-ellipsis> S3 storage lens </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/big-data-tenant-analytics/ class=md-nav__link> <span class=md-ellipsis> SaaS demo </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> Coding </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Coding </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../coding/ class=md-nav__link> <span class=md-ellipsis> Practices </span> </a> </li> <li class=md-nav__item> <a href=../../coding/sam/ class=md-nav__link> <span class=md-ellipsis> SAM </span> </a> </li> <li class=md-nav__item> <a href=../../coding/cloudFormation/ class=md-nav__link> <span class=md-ellipsis> CloudFormation </span> </a> </li> <li class=md-nav__item> <a href=../../coding/cdk/ class=md-nav__link> <span class=md-ellipsis> CDK </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io class=md-nav__link> <span class=md-ellipsis> Return to main </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#migration class=md-nav__link> <span class=md-ellipsis> Migration </span> </a> <nav class=md-nav aria-label=Migration> <ul class=md-nav__list> <li class=md-nav__item> <a href=#migrate-an-old-not-maintained-app class=md-nav__link> <span class=md-ellipsis> Migrate an old not maintained app </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#networking class=md-nav__link> <span class=md-ellipsis> Networking </span> </a> <nav class=md-nav aria-label=Networking> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hybrid-integration-with-2-aws-regions class=md-nav__link> <span class=md-ellipsis> Hybrid integration with 2 AWS regions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security class=md-nav__link> <span class=md-ellipsis> Security </span> </a> <nav class=md-nav aria-label=Security> <ul class=md-nav__list> <li class=md-nav__item> <a href=#use-identity-center-user-to-perform-aws-cli class=md-nav__link> <span class=md-ellipsis> Use Identity Center user to perform AWS CLI </span> </a> </li> <li class=md-nav__item> <a href=#blocking-an-ip-address class=md-nav__link> <span class=md-ellipsis> Blocking an IP address </span> </a> </li> <li class=md-nav__item> <a href=#using-identity-federation class=md-nav__link> <span class=md-ellipsis> Using identity federation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#stateless-with-persistence-app class=md-nav__link> <span class=md-ellipsis> Stateless with persistence app </span> </a> <nav class=md-nav aria-label="Stateless with persistence app"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#how-to-change-an-ec2-instance-type-while-the-host-runs-a-webapp-without-impacting-client-apps class=md-nav__link> <span class=md-ellipsis> How to change an EC2 instance type, while the host runs a webapp, without impacting client apps? </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#stateful-app class=md-nav__link> <span class=md-ellipsis> Stateful app </span> </a> </li> <li class=md-nav__item> <a href=#sharing-images class=md-nav__link> <span class=md-ellipsis> Sharing images </span> </a> </li> <li class=md-nav__item> <a href=#disaster-recovery-solution class=md-nav__link> <span class=md-ellipsis> Disaster Recovery Solution </span> </a> <nav class=md-nav aria-label="Disaster Recovery Solution"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#backup-multi-regions class=md-nav__link> <span class=md-ellipsis> Backup multi-regions </span> </a> </li> <li class=md-nav__item> <a href=#warm-region class=md-nav__link> <span class=md-ellipsis> Warm region </span> </a> </li> <li class=md-nav__item> <a href=#active-active-between-multi-regions class=md-nav__link> <span class=md-ellipsis> Active - Active between multi regions </span> </a> </li> <li class=md-nav__item> <a href=#aws-services-supporting-ha-and-dr-multi-regions class=md-nav__link> <span class=md-ellipsis> AWS Services supporting HA and DR multi-regions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#saas-deployment-for-an-isv class=md-nav__link> <span class=md-ellipsis> SaaS deployment for an ISV </span> </a> </li> <li class=md-nav__item> <a href=#a-question-of-caching class=md-nav__link> <span class=md-ellipsis> A question of caching </span> </a> </li> <li class=md-nav__item> <a href=#amazon-codedeploy-demonstration class=md-nav__link> <span class=md-ellipsis> Amazon CodeDeploy Demonstration </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=solution-design-fun-with-aws-services>Solution design fun with AWS services<a class=headerlink href=#solution-design-fun-with-aws-services title="Permanent link">&para;</a></h1> <p>This section presents examples of solution design using AWS services, with links to external demonstrations when available.</p> <h2 id=migration>Migration<a class=headerlink href=#migration title="Permanent link">&para;</a></h2> <h3 id=migrate-an-old-not-maintained-app>Migrate an old not maintained app<a class=headerlink href=#migrate-an-old-not-maintained-app title="Permanent link">&para;</a></h3> <ul> <li>When application uses custom OS configurations, use Application Migration Service.</li> <li>Replatform existing database server to Amazon RDS. AWS Database Migration Service gives the ability to convert DB to a supported RDS engine such as MySQL. AWS Schema Conversion Tool supports the schema conversion to Amazon RDS.</li> </ul> <h2 id=networking>Networking<a class=headerlink href=#networking title="Permanent link">&para;</a></h2> <h3 id=hybrid-integration-with-2-aws-regions>Hybrid integration with 2 AWS regions<a class=headerlink href=#hybrid-integration-with-2-aws-regions title="Permanent link">&para;</a></h3> <h2 id=security>Security<a class=headerlink href=#security title="Permanent link">&para;</a></h2> <h3 id=use-identity-center-user-to-perform-aws-cli>Use Identity Center user to perform AWS CLI<a class=headerlink href=#use-identity-center-user-to-perform-aws-cli title="Permanent link">&para;</a></h3> <ul> <li>Create an identity center in one region, and add users</li> <li>Create IAM service role, for CodeDeploy, for each target compute environment: for lambda uses <code>AWSCodeDeployRoleForLambda</code>. (See <a href=https://docs.aws.amazon.com/codedeploy/latest/userguide/getting-started-create-service-role.html>this note for detail</a>).</li> </ul> <h3 id=blocking-an-ip-address>Blocking an IP address<a class=headerlink href=#blocking-an-ip-address title="Permanent link">&para;</a></h3> <p>There are multiple solutions to support blocking an IP@ or a range of IP@ depending of the deployment.</p> <details class=-> <summary>Simplest using NACL</summary> <p>Define network inbound rule to deny a specific IP@ on all traffic types.</p> </details> <h3 id=using-identity-federation>Using identity federation<a class=headerlink href=#using-identity-federation title="Permanent link">&para;</a></h3> <ul> <li>Users are identified with corporate directory, or 3nd party identity provider.</li> <li>Users need to work on AWS resources, or with applications that access AWS resources</li> <li>Cognito is a first solution for mobile and web apps, as it supports 3nd party IdP compatible with OpenID Connect (OIDC). The AWS SDK is used to create an identities for the users so they can be authenticated. It support anonymous sign-ins.</li> <li>When existing on-premises uses SAML 2.0, we can create a trust between the AWS as service provider and the org as IdP. Use SAML to provide the users with federated single-sign on (SSO) to the AWS Management Console or federated access to call AWS API operations.</li> <li>Alternatively we can build a custom identity broker app, calling assumeRole or GetFederationToken to AWS STS to get temporary credentials (access key ID, a secret access key, and a session token). Apps can then use the temporary credentials to make calls to AWS directly.</li> <li>In a SAML federation scenario, the IdP is responsible for the authentication and coarse grained authorization of all AWS users. AWS is then able to leverage and consume these identity assertions according to a preestablished cryptographic trust.</li> </ul> <p><img alt src=https://docs.aws.amazon.com/images/IAM/latest/UserGuide/images/enterprise-authentication-with-identity-broker-application.diagram.png></p> <p>For study or demonstration purposes, the identity store could be OpenLDAP the identity provider, <a href=https://shibboleth.atlassian.net/wiki/spaces/IDP4/overview>Shibboleth</a>. See <a href=https://identity-federation.awssecworkshops.com/opensource/ >this workshop: A Self-Directed Journey to AWS Identity Federation Mastery - Open Source variant</a>. Once both are running on a server (like EC2), we can configure Shibboleth to offer authentication services for AWS using the <code>relying party</code> configuration.</p> <ul> <li>In a SAML federation, the Identity Provider can pass various attributes about the user, the authentication method, or other points of context to the service provider (in this case AWS) in the form of SAML attributes. In order for SAML federation for AWS to function properly, <a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers_create_saml_assertions.html>several attributes</a> are required.</li> <li>The IdP is entirely responsible for authorizing which roles within AWS a given user can assume. The groups in LDAP are the source of truth. </li> <li>The first attribute is the <code>Roles</code> attribute, which specifies combinations of AWS IAM Roles and authorizing AWS IAM Identity Providers that the user is authorized to assume. The mapping can be done from a <code>memberOf</code> attribute from LDAP which includes groups the user belong to. This information is mapped to a IAM Role ARN. The group name in LDAP needs to follow a naming convention, like: <code>AWS-Account Number-Role Name</code>.</li> <li>Apply <strong>separation of duties</strong>: users will have different roles in different accounts.</li> <li>The second AWS specific attribute is <code>RoleSessionName</code>. This attribute is recorded as part of the identity within CloudTrail to ensure that we can properly account for the federated user's actions. It is mapped from the LDAP <code>uid</code> of the user.</li> <li> <p>Once IdP configuration is done, we need to configure AWS to trust the authentication and authorization information the IdP provides. We need the SAML metadata which details all of the encryption and signing certificates that IdP will use.</p> <p><img alt src=../images/idp-cfg.png></p> </li> <li> <p>Add IAM Roles in each AWS Account to match the groups define in LDAP, using SAML as trusted entity</p> <p><img alt src=../images/role-saml-src.png></p> </li> <li> <p>Add any security policy the role needs to be able to perform on AWS service.</p> </li> <li>User authenticates using the IdP login page, once done, the user is redirected to AWS role chooser page (as a user may have multiple AWS IAM roles). Also for CLI, and <code>aws configure</code> will use the keys and token from the STS response which was authenticated by the SAML assertion returned by the IdP.</li> <li>Resource policy can auhorize federated users too. For example S3 resource policy may look like: Deny all s3 actions to the bucket, but only when the aws:userid is not the following list:</li> </ul> <div class=highlight><pre><span></span><code><span class=w>    </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;Sid&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;AllowSpecificUsersAndInstances&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Deny&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;Principal&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;*&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;s3:*&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>          </span><span class=s2>&quot;arn:aws:s3:::&lt;YOUR_BUCKET_HERE&gt;&quot;</span><span class=p>,</span>
<span class=w>          </span><span class=s2>&quot;arn:aws:s3:::&lt;YOUR_BUCKET_HERE&gt;/*&quot;</span>
<span class=w>        </span><span class=p>],</span>
<span class=w>        </span><span class=nt>&quot;Condition&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>           </span><span class=nt>&quot;StringNotLike&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>              </span><span class=nt>&quot;aws:userid&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>                </span><span class=s2>&quot;&lt;ROOT_ACCOUNT&gt;&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=s2>&quot;&lt;EC2RoleId:RoleSessionName&gt;&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=s2>&quot;&lt;FederationRoleId:RoleSessionName&gt;&quot;</span>
<span class=w>              </span><span class=p>]</span>
<span class=w>    </span><span class=err>...</span>
</code></pre></div> <h2 id=stateless-with-persistence-app>Stateless with persistence app<a class=headerlink href=#stateless-with-persistence-app title="Permanent link">&para;</a></h2> <h3 id=how-to-change-an-ec2-instance-type-while-the-host-runs-a-webapp-without-impacting-client-apps>How to change an EC2 instance type, while the host runs a webapp, without impacting client apps?<a class=headerlink href=#how-to-change-an-ec2-instance-type-while-the-host-runs-a-webapp-without-impacting-client-apps title="Permanent link">&para;</a></h3> <p>The simplest example is one EC2 with a Java based webapp deployed on it. Upgrading the EC2 instance type, brings the webapp down.</p> <p><img alt src=../diagrams/simple-quarkus-app.drawio.svg></p> <details class=-> <summary>The basic solution</summary> <p>Use Elastic IP address (public or private) so clients keep the IP @. (EC2&gt; Elastic IP addresses&gt; Allocate Elastic IP address). </p> <p>Recall that we need to be able to SSH to the EC2 instance, to install language runtime, copy the tar of the app to the linux EC2 /home/users or somewhere else. Do not forget to use the .pem file downloaded when creating the EC2. <code>scp -i ec2host.pem ...</code></p> </details> <details class=-> <summary>Cleaner solution</summary> <p>We should add a DNS domain and subdomain with Amazon Route 53 records, two ALBs, one per AZ, with Health Checks to Route 53, restricted security groups and public and private subnets, auto scaling group, and may be, use one reserved EC2 instance per AZ to reduce long term cost.</p> <p><img alt src=../diagrams/better-quarkus-app.drawio.svg></p> <p>For the backend/database solution use a HA service like Aurora or DynamoDB.</p> </details> <h2 id=stateful-app>Stateful app<a class=headerlink href=#stateful-app title="Permanent link">&para;</a></h2> <p>Keep data (shopping cart) into session. We can use the stickiness on ELB and session affinity. Or use a user cookie, with the app verifying the cookie content. </p> <p>When we need to keep more data than what the cookie can save, then we keep the sessionID in the cookie and deploy an ElasticCache to store data with the key of sessionID.</p> <p>Final transactional data can be persisted in RDS, and with RDS replication we can route specific traffic ("/products") which is read/only to the RDS Read replicas. Which can also being supported by having the product in the ElasticCache.</p> <p><img alt src=../diagrams/stateful-quarkus-app.drawio.svg></p> <h2 id=sharing-images>Sharing images<a class=headerlink href=#sharing-images title="Permanent link">&para;</a></h2> <p>There are multiple solutions for this problem depending of the requirements:</p> <ol> <li>S3 with CloudFront for static content </li> <li> <p>With EC2 and EFS:</p> <p><img alt src=../diagrams/images-sol.drawio.svg></p> </li> </ol> <h2 id=disaster-recovery-solution>Disaster Recovery Solution<a class=headerlink href=#disaster-recovery-solution title="Permanent link">&para;</a></h2> <p>We try to address disaster and recovery for different needs, knowing that not all applications need active/active deployment.</p> <h3 id=backup-multi-regions>Backup multi-regions<a class=headerlink href=#backup-multi-regions title="Permanent link">&para;</a></h3> <p>The simplest resilience solution is to use backup and restore mechanism. Data and configuration can be moved to S3 in the second region. For even longer time we can use Glacier. Use database service to ensure HA at the zone level, and replicate data within AZ.</p> <p><img alt src=../images/backup-mr.png></p> <p>RPO will be average time between snapshots - and RTO at the day level.</p> <h3 id=warm-region>Warm region<a class=headerlink href=#warm-region title="Permanent link">&para;</a></h3> <p>For applications, where we want to limit out of services time, the approach is to replicate AMI images so app servers, in DR region, can be restarted quickly. And Database are replicated and warm on the second region. Web servers are also warm but not receiving traffic.</p> <p><img alt src=../images/warm-dr.png></p> <p>If something go down in region 1, the internet facing router (53) will route to local balancers in second region.</p> <p>RTO is now in minutes, and RPO average time between DB snapshots. </p> <h3 id=active-active-between-multi-regions>Active - Active between multi regions<a class=headerlink href=#active-active-between-multi-regions title="Permanent link">&para;</a></h3> <h4 id=write-global-read-local-pattern>Write global - read local pattern<a class=headerlink href=#write-global-read-local-pattern title="Permanent link">&para;</a></h4> <p>Users close to one region will read from this region and all write operations go to a global service / region.</p> <p><img alt src=../images/write-global.png></p> <p>Database replications and snapshot replications are done to keep data eventually consistent between regions. Those synchronisations are in sub second.</p> <h4 id=write-to-origin-read-local-pattern>Write to origin - read local pattern<a class=headerlink href=#write-to-origin-read-local-pattern title="Permanent link">&para;</a></h4> <p>To increase in complexity, R/W can go the local region. So when a user writes new records, he/she is associated to a region, so the application is sharding the data. When the user moved to another region, write operation will still go to the first region, while read could happened on the region close to him.</p> <p>This applies to applications with write to read ratio around 50%.</p> <h4 id=write-read-local-anti-pattern>Write / read local (anti) pattern<a class=headerlink href=#write-read-local-anti-pattern title="Permanent link">&para;</a></h4> <p>This pattern uses two master DB, one in each region so user can write and read locally. Dual writes, in each region, at the same time may generate the same key but record will have different data. You have inconsistency, and it is difficult to figure out, and rollback. So use this pattern only if you cannot do the two previous patterns.</p> <h3 id=aws-services-supporting-ha-and-dr-multi-regions>AWS Services supporting HA and DR multi-regions<a class=headerlink href=#aws-services-supporting-ha-and-dr-multi-regions title="Permanent link">&para;</a></h3> <ul> <li><a href=../../infra/storage/#s3-simple-storage-service>S3</a></li> <li><a href=../../infra/storage/#amazon-elastic-block-storage-ebs>EBS</a></li> <li><a href=../../data/dynamodb/ >DynamoDB</a></li> </ul> <h2 id=saas-deployment-for-an-isv>SaaS deployment for an ISV<a class=headerlink href=#saas-deployment-for-an-isv title="Permanent link">&para;</a></h2> <p>See also <a href=../saas/ >SaaS considerations</a>.</p> <p>The ISV provides a data platform to manage data with performance and feature set compare to data warehouse but at the scale and low cost of data lake. On top of the data their platform helps to develop ML model, visualize data and build integrate view of distributed, structured and unstructured data.</p> <p><img alt src=../images/datalake-isv.png></p> <p>They developed a multi-tenancy SaaS platform to manage their customer deployments. Customers will create instance of this managed service in their own VPC and integrate with their own data source and data pipeline, to organize this data processing into data ingestion, data engineering, serving layer and analytics. Part of their platform is also to provide easy integration into AWS data services like Kinesis, S3, RDS, Redshift… This ISV is gathering data from the customer usage of their platform, get real time metrics, and manage all this in the AWS cloud using existing managed services as S3, Glacier for long persistence, streaming, redshift,…</p> <h2 id=a-question-of-caching>A question of caching<a class=headerlink href=#a-question-of-caching title="Permanent link">&para;</a></h2> <p>We have different level of information caching with different throughput. </p> <p><img alt src=../diagrams/caching.drawio.png></p> <ul> <li>Routes and DNS are cached in Route 53</li> <li>CloudFront can cache static data, with 100k requests/s</li> <li>ALB can have some caching of API response</li> <li>or API Gateway can do caching too, with 10k r/s</li> <li>Computer layer is slower but can scale horizontally, using ASG, Lambda or container on Fargate</li> <li>Database layer can scale with read replicas, or local read accelerator like DAX for Dynamodb.</li> <li>ElasticCaches can be used with Redis or Memcached.</li> <li>EBS volumes or instance store can be used to cache data in the EC2 machine.</li> <li>When decoupling components using queueing, caching can be done too.</li> <li>CloudFront Edge can be used to cache content from S3, which has baseline performance of 5500 GET per prefix/s. </li> <li>Encryption with KMS will impact those number as KMS has 10k API calls per region</li> </ul> <h2 id=amazon-codedeploy-demonstration>Amazon CodeDeploy Demonstration<a class=headerlink href=#amazon-codedeploy-demonstration title="Permanent link">&para;</a></h2> <ul> <li> <p><a href=https://docs.aws.amazon.com/codedeploy/latest/userguide/tutorials-github.html>Deploy an application from GitHub</a>. See <a href=https://github.com/jbcodeforce/AWS-CodeDeployGitHubDemo>this repo AWS-CodeDeployGitHubDemo</a>. The git repository has a <code>appspec</code> file which define scripts to run in different stages of the deployment. The app uses HTTPD and a basic HTML page.</p> <p><img alt src=../diagrams/code-dep-ec2-git.drawio.png></p> </li> <li> <p>Create a role with EC2 and codedeploy as trusted principals</p> <div class=highlight><pre><span></span><code><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;Sid&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;Principal&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nt>&quot;Service&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>                </span><span class=s2>&quot;codedeploy.amazonaws.com&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=s2>&quot;ec2.amazonaws.com&quot;</span>
<span class=w>            </span><span class=p>]</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;sts:AssumeRole&quot;</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>]</span>
</code></pre></div> <p>With the inline policy like</p> <div class=highlight><pre><span></span><code><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>            </span><span class=s2>&quot;s3:Get*&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s2>&quot;s3:List*&quot;</span>
<span class=w>        </span><span class=p>],</span>
<span class=w>        </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>            </span><span class=s2>&quot;arn:aws:s3:::jb-data-set/*&quot;</span><span class=p>,</span>
<span class=w>             </span><span class=s2>&quot;arn:aws:s3:::aws-codedeploy-us-west-2/*&quot;</span>
<span class=w>             </span><span class=p>]</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>]</span>
</code></pre></div> </li> <li> <p>Add an instance profile and add the role to the instance profile</p> <div class=highlight><pre><span></span><code>aws<span class=w> </span>iam<span class=w> </span>create-instance-profile<span class=w> </span>--instance-profile-name<span class=w> </span>CodeDeployDemo-EC2-Instance-Profile
aws<span class=w> </span>iam<span class=w> </span>add-role-to-instance-profile<span class=w> </span>--instance-profile-name<span class=w> </span>CodeDeployDemo-EC2-Instance-Profile<span class=w> </span>--role-name<span class=w> </span>CodeDeployDemo-EC2-Instance-Profile
</code></pre></div> </li> <li> <p>Create an EC2 instance with CodeDeploy Agent: use the instance profile created above and the following user data:</p> <div class=highlight><pre><span></span><code>sudo yum update
sudo yum install -y ruby wget
wget https://aws-codedeploy-us-west-2.s3.us-west-2.amazonaws.com/latest/install
chmod +x ./install
sudo ./install auto
sudo service codedeploy-agent status
</code></pre></div> </li> <li> <p>Add an application in CodeDeploy:</p> <div class=highlight><pre><span></span><code>aws<span class=w> </span>deploy<span class=w> </span>create-application<span class=w> </span>--application-name<span class=w> </span>CodeDeployGitHubDemo-App
aws<span class=w> </span>deploy<span class=w> </span>create-deployment-group<span class=w> </span>--application-name<span class=w> </span>CodeDeployGitHubDemo-App<span class=w> </span>--ec2-tag-filters<span class=w> </span><span class=nv>Key</span><span class=o>=</span>Name,Type<span class=o>=</span>name,Value<span class=o>=</span>CodeDeployDemo<span class=w> </span>--deployment-group-name<span class=w> </span>CodeDeployGitHubDemo-DepGrp<span class=w> </span>--service-role-arn<span class=w> </span>CodeDeployDemo-EC2-Instance-Profile
</code></pre></div> </li> <li> <p>Create a deployment</p> <div class=highlight><pre><span></span><code>aws<span class=w> </span>deploy<span class=w> </span>create-deployment<span class=w> </span><span class=se>\</span>
<span class=w>        </span>--application-name<span class=w> </span>CodeDeployGitHubDemo-App<span class=w> </span><span class=se>\</span>
<span class=w>        </span>--deployment-config-name<span class=w> </span>CodeDeployDefault.OneAtATime<span class=w> </span><span class=se>\</span>
<span class=w>        </span>--deployment-group-name<span class=w> </span>CodeDeployGitHubDemo-DepGrp<span class=w> </span><span class=se>\</span>
<span class=w>        </span>--description<span class=w> </span><span class=s2>&quot;My GitHub deployment demo&quot;</span><span class=w> </span><span class=se>\</span>
<span class=w>        </span>--github-location<span class=w> </span><span class=nv>repository</span><span class=o>=</span>jbcodeforce/,commitId<span class=o>=</span>a40chars-string-from-commit-id
</code></pre></div> </li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../well-architectured/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Well Architectured"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Well Architectured </div> </div> </a> <a href=../psa-role/ class="md-footer__link md-footer__link--next" aria-label="Next: SA"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> SA </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.code.copy", "content.tooltips", "navigation.instant", "navigation.tracking", "navigation.footer", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.af256bd8.min.js></script> </body> </html>