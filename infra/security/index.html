<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Jerome Boyer"><link href=../networking/ rel=prev><link href=../storage/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.33"><title>Security - AWS Studies</title><link rel=stylesheet href=../../assets/stylesheets/main.3cba04c6.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#security class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="AWS Studies" class="md-header__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AWS Studies </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Security </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/yarfba.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="AWS Studies" class="md-nav__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> AWS Studies </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/yarfba.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Infrastructure </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Infrastructure </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> EC2-others </span> </a> </li> <li class=md-nav__item> <a href=../networking/ class=md-nav__link> <span class=md-ellipsis> Networking </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Security </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Security </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=#1-identity class=md-nav__link> <span class=md-ellipsis> 1- Identity </span> </a> <nav class=md-nav aria-label="1- Identity"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#iam-identity-and-access-management class=md-nav__link> <span class=md-ellipsis> IAM Identity and Access Management </span> </a> </li> <li class=md-nav__item> <a href=#security-policies class=md-nav__link> <span class=md-ellipsis> Security Policies </span> </a> </li> <li class=md-nav__item> <a href=#iam-roles class=md-nav__link> <span class=md-ellipsis> IAM Roles </span> </a> </li> <li class=md-nav__item> <a href=#permissions-boundary class=md-nav__link> <span class=md-ellipsis> Permissions boundary </span> </a> </li> <li class=md-nav__item> <a href=#security-tools class=md-nav__link> <span class=md-ellipsis> Security tools </span> </a> </li> <li class=md-nav__item> <a href=#iam-identity-center class=md-nav__link> <span class=md-ellipsis> IAM Identity Center </span> </a> </li> <li class=md-nav__item> <a href=#aws-organizations class=md-nav__link> <span class=md-ellipsis> AWS Organizations </span> </a> </li> <li class=md-nav__item> <a href=#aws-security-token-service-api class=md-nav__link> <span class=md-ellipsis> AWS Security Token Service API </span> </a> </li> <li class=md-nav__item> <a href=#amazon-cognito class=md-nav__link> <span class=md-ellipsis> Amazon Cognito </span> </a> </li> <li class=md-nav__item> <a href=#resource-access-manager class=md-nav__link> <span class=md-ellipsis> Resource Access Manager </span> </a> </li> <li class=md-nav__item> <a href=#aws-control-tower class=md-nav__link> <span class=md-ellipsis> AWS Control Tower </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-data-protection class=md-nav__link> <span class=md-ellipsis> 2- Data Protection </span> </a> <nav class=md-nav aria-label="2- Data Protection"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#encryption class=md-nav__link> <span class=md-ellipsis> Encryption </span> </a> </li> <li class=md-nav__item> <a href=#kms class=md-nav__link> <span class=md-ellipsis> KMS </span> </a> </li> <li class=md-nav__item> <a href=#s3-encryption-considerations class=md-nav__link> <span class=md-ellipsis> S3 encryption considerations </span> </a> </li> <li class=md-nav__item> <a href=#encrypted-ami-sharing-process class=md-nav__link> <span class=md-ellipsis> Encrypted AMI sharing process </span> </a> </li> <li class=md-nav__item> <a href=#system-management-parameter-store class=md-nav__link> <span class=md-ellipsis> System management parameter store </span> </a> </li> <li class=md-nav__item> <a href=#amazon-macie class=md-nav__link> <span class=md-ellipsis> Amazon Macie </span> </a> </li> <li class=md-nav__item> <a href=#secrets-manager class=md-nav__link> <span class=md-ellipsis> Secrets Manager </span> </a> </li> <li class=md-nav__item> <a href=#acm-certificate-manager class=md-nav__link> <span class=md-ellipsis> ACM - Certificate Manager </span> </a> </li> <li class=md-nav__item> <a href=#aws-cloudhsm class=md-nav__link> <span class=md-ellipsis> AWS CloudHSM </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-network-and-app-protection class=md-nav__link> <span class=md-ellipsis> 3- Network and App Protection </span> </a> <nav class=md-nav aria-label="3- Network and App Protection"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#waf-web-application-firewall class=md-nav__link> <span class=md-ellipsis> WAF Web Application Firewall </span> </a> </li> <li class=md-nav__item> <a href=#aws-shield class=md-nav__link> <span class=md-ellipsis> AWS Shield </span> </a> </li> <li class=md-nav__item> <a href=#firewall-manager class=md-nav__link> <span class=md-ellipsis> Firewall manager </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-threat-detection-monitoring class=md-nav__link> <span class=md-ellipsis> 4 - Threat Detection &amp; monitoring </span> </a> <nav class=md-nav aria-label="4 - Threat Detection & monitoring"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aws-security-hub class=md-nav__link> <span class=md-ellipsis> AWS Security Hub </span> </a> </li> <li class=md-nav__item> <a href=#amazon-guardduty class=md-nav__link> <span class=md-ellipsis> Amazon GuardDuty </span> </a> </li> <li class=md-nav__item> <a href=#amazon-detective class=md-nav__link> <span class=md-ellipsis> Amazon Detective </span> </a> </li> <li class=md-nav__item> <a href=#amazon-inspector class=md-nav__link> <span class=md-ellipsis> Amazon Inspector </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#privacy-and-compliance class=md-nav__link> <span class=md-ellipsis> Privacy and Compliance </span> </a> <nav class=md-nav aria-label="Privacy and Compliance"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aws-audit-manager class=md-nav__link> <span class=md-ellipsis> AWS Audit Manager </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aws-cloudtrail class=md-nav__link> <span class=md-ellipsis> AWS CloudTrail </span> </a> </li> <li class=md-nav__item> <a href=#security-faqs class=md-nav__link> <span class=md-ellipsis> Security FAQs </span> </a> </li> <li class=md-nav__item> <a href=#solution-design class=md-nav__link> <span class=md-ellipsis> Solution Design </span> </a> <nav class=md-nav aria-label="Solution Design"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#blocking-ip-address class=md-nav__link> <span class=md-ellipsis> Blocking IP address </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-learn-more class=md-nav__link> <span class=md-ellipsis> Security Learn more </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../storage/ class=md-nav__link> <span class=md-ellipsis> S3-Storage </span> </a> </li> <li class=md-nav__item> <a href=../route53/ class=md-nav__link> <span class=md-ellipsis> Route 53 </span> </a> </li> <li class=md-nav__item> <a href=../../monitoring/monitoring/ class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> <li class=md-nav__item> <a href=../../monitoring/cost/ class=md-nav__link> <span class=md-ellipsis> Cost mgt </span> </a> </li> <li class=md-nav__item> <a href=../../kinesis/ class=md-nav__link> <span class=md-ellipsis> Kinesis* </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sa/well-architectured/ class=md-nav__link> <span class=md-ellipsis> Well Architectured </span> </a> </li> <li class=md-nav__item> <a href=../../sa/sol-design/ class=md-nav__link> <span class=md-ellipsis> Solution design </span> </a> </li> <li class=md-nav__item> <a href=../../sa/psa-role/ class=md-nav__link> <span class=md-ellipsis> SA </span> </a> </li> <li class=md-nav__item> <a href=../../sa/saas/ class=md-nav__link> <span class=md-ellipsis> SaaS </span> </a> </li> <li class=md-nav__item> <a href=../../sa/resiliency/ class=md-nav__link> <span class=md-ellipsis> Resiliency </span> </a> </li> <li class=md-nav__item> <a href=../../templ/ class=md-nav__link> <span class=md-ellipsis> Conduct Design session </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Analytics </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Analytics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../analytics/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../analytics/emr/ class=md-nav__link> <span class=md-ellipsis> EMR </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Data </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../data/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../data/rds/ class=md-nav__link> <span class=md-ellipsis> RDS-Aurora </span> </a> </li> <li class=md-nav__item> <a href=../../data/dynamodb/ class=md-nav__link> <span class=md-ellipsis> DynamoDB </span> </a> </li> <li class=md-nav__item> <a href=../../data/data-lake/ class=md-nav__link> <span class=md-ellipsis> Data Lake </span> </a> </li> <li class=md-nav__item> <a href=../../data/redshift/ class=md-nav__link> <span class=md-ellipsis> RedShift </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> AI-ML </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> AI-ML </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ai-ml/ class=md-nav__link> <span class=md-ellipsis> All Services </span> </a> </li> <li class=md-nav__item> <a href=../../ai-ml/sagemaker/ class=md-nav__link> <span class=md-ellipsis> SageMaker </span> </a> </li> <li class=md-nav__item> <a href=../../ai-ml/bedrock/ class=md-nav__link> <span class=md-ellipsis> Bedrock </span> </a> </li> <li class=md-nav__item> <a href=../../ai-ml/q/ class=md-nav__link> <span class=md-ellipsis> Amazon Q </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Serverless </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Serverless </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../serverless/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/lambda/ class=md-nav__link> <span class=md-ellipsis> Lambda </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/apigtw/ class=md-nav__link> <span class=md-ellipsis> API Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/ecs/ class=md-nav__link> <span class=md-ellipsis> ECS </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/eks/ class=md-nav__link> <span class=md-ellipsis> EKS </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/aws-messaging-study class=md-nav__link> <span class=md-ellipsis> Messaging </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/msk/ class=md-nav__link> <span class=md-ellipsis> MSK </span> </a> </li> <li class=md-nav__item> <a href=../../kinesis/ class=md-nav__link> <span class=md-ellipsis> Kinesis* </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/eventbridge/ class=md-nav__link> <span class=md-ellipsis> EventBridge </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/stepfct/ class=md-nav__link> <span class=md-ellipsis> Step function </span> </a> </li> <li class=md-nav__item> <a href=../../serverless/mwaa/ class=md-nav__link> <span class=md-ellipsis> MWAA </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Playground </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Playground </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../playground/ class=md-nav__link> <span class=md-ellipsis> AWS personal labs </span> </a> </li> <li class=md-nav__item> <a href=../../playground/gettingstarted/ class=md-nav__link> <span class=md-ellipsis> Getting Started EC2 </span> </a> </li> <li class=md-nav__item> <a href=../../playground/security/ class=md-nav__link> <span class=md-ellipsis> Security-IAM demos </span> </a> </li> <li class=md-nav__item> <a href=../../playground/s3-play/ class=md-nav__link> <span class=md-ellipsis> S3 play </span> </a> </li> <li class=md-nav__item> <a href=../../playground/networking/ class=md-nav__link> <span class=md-ellipsis> Networking </span> </a> </li> <li class=md-nav__item> <a href=../../playground/rds/ class=md-nav__link> <span class=md-ellipsis> RDS </span> </a> </li> <li class=md-nav__item> <a href=../../playground/rt-data-processing/ class=md-nav__link> <span class=md-ellipsis> Data processing </span> </a> </li> <li class=md-nav__item> <a href=../../playground/spark-emr/ class=md-nav__link> <span class=md-ellipsis> Analytics on EMR </span> </a> </li> <li class=md-nav__item> <a href=../../playground/ecs/ class=md-nav__link> <span class=md-ellipsis> ECS </span> </a> </li> <li class=md-nav__item> <a href=../../playground/s3-org-billing/ class=md-nav__link> <span class=md-ellipsis> S3 storage lens </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/big-data-tenant-analytics/ class=md-nav__link> <span class=md-ellipsis> SaaS demo </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> Coding </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Coding </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../coding/ class=md-nav__link> <span class=md-ellipsis> Practices </span> </a> </li> <li class=md-nav__item> <a href=../../coding/sam/ class=md-nav__link> <span class=md-ellipsis> SAM </span> </a> </li> <li class=md-nav__item> <a href=../../coding/cloudFormation/ class=md-nav__link> <span class=md-ellipsis> CloudFormation </span> </a> </li> <li class=md-nav__item> <a href=../../coding/cdk/ class=md-nav__link> <span class=md-ellipsis> CDK </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io class=md-nav__link> <span class=md-ellipsis> Return to main </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=#1-identity class=md-nav__link> <span class=md-ellipsis> 1- Identity </span> </a> <nav class=md-nav aria-label="1- Identity"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#iam-identity-and-access-management class=md-nav__link> <span class=md-ellipsis> IAM Identity and Access Management </span> </a> </li> <li class=md-nav__item> <a href=#security-policies class=md-nav__link> <span class=md-ellipsis> Security Policies </span> </a> </li> <li class=md-nav__item> <a href=#iam-roles class=md-nav__link> <span class=md-ellipsis> IAM Roles </span> </a> </li> <li class=md-nav__item> <a href=#permissions-boundary class=md-nav__link> <span class=md-ellipsis> Permissions boundary </span> </a> </li> <li class=md-nav__item> <a href=#security-tools class=md-nav__link> <span class=md-ellipsis> Security tools </span> </a> </li> <li class=md-nav__item> <a href=#iam-identity-center class=md-nav__link> <span class=md-ellipsis> IAM Identity Center </span> </a> </li> <li class=md-nav__item> <a href=#aws-organizations class=md-nav__link> <span class=md-ellipsis> AWS Organizations </span> </a> </li> <li class=md-nav__item> <a href=#aws-security-token-service-api class=md-nav__link> <span class=md-ellipsis> AWS Security Token Service API </span> </a> </li> <li class=md-nav__item> <a href=#amazon-cognito class=md-nav__link> <span class=md-ellipsis> Amazon Cognito </span> </a> </li> <li class=md-nav__item> <a href=#resource-access-manager class=md-nav__link> <span class=md-ellipsis> Resource Access Manager </span> </a> </li> <li class=md-nav__item> <a href=#aws-control-tower class=md-nav__link> <span class=md-ellipsis> AWS Control Tower </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-data-protection class=md-nav__link> <span class=md-ellipsis> 2- Data Protection </span> </a> <nav class=md-nav aria-label="2- Data Protection"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#encryption class=md-nav__link> <span class=md-ellipsis> Encryption </span> </a> </li> <li class=md-nav__item> <a href=#kms class=md-nav__link> <span class=md-ellipsis> KMS </span> </a> </li> <li class=md-nav__item> <a href=#s3-encryption-considerations class=md-nav__link> <span class=md-ellipsis> S3 encryption considerations </span> </a> </li> <li class=md-nav__item> <a href=#encrypted-ami-sharing-process class=md-nav__link> <span class=md-ellipsis> Encrypted AMI sharing process </span> </a> </li> <li class=md-nav__item> <a href=#system-management-parameter-store class=md-nav__link> <span class=md-ellipsis> System management parameter store </span> </a> </li> <li class=md-nav__item> <a href=#amazon-macie class=md-nav__link> <span class=md-ellipsis> Amazon Macie </span> </a> </li> <li class=md-nav__item> <a href=#secrets-manager class=md-nav__link> <span class=md-ellipsis> Secrets Manager </span> </a> </li> <li class=md-nav__item> <a href=#acm-certificate-manager class=md-nav__link> <span class=md-ellipsis> ACM - Certificate Manager </span> </a> </li> <li class=md-nav__item> <a href=#aws-cloudhsm class=md-nav__link> <span class=md-ellipsis> AWS CloudHSM </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-network-and-app-protection class=md-nav__link> <span class=md-ellipsis> 3- Network and App Protection </span> </a> <nav class=md-nav aria-label="3- Network and App Protection"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#waf-web-application-firewall class=md-nav__link> <span class=md-ellipsis> WAF Web Application Firewall </span> </a> </li> <li class=md-nav__item> <a href=#aws-shield class=md-nav__link> <span class=md-ellipsis> AWS Shield </span> </a> </li> <li class=md-nav__item> <a href=#firewall-manager class=md-nav__link> <span class=md-ellipsis> Firewall manager </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-threat-detection-monitoring class=md-nav__link> <span class=md-ellipsis> 4 - Threat Detection &amp; monitoring </span> </a> <nav class=md-nav aria-label="4 - Threat Detection & monitoring"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aws-security-hub class=md-nav__link> <span class=md-ellipsis> AWS Security Hub </span> </a> </li> <li class=md-nav__item> <a href=#amazon-guardduty class=md-nav__link> <span class=md-ellipsis> Amazon GuardDuty </span> </a> </li> <li class=md-nav__item> <a href=#amazon-detective class=md-nav__link> <span class=md-ellipsis> Amazon Detective </span> </a> </li> <li class=md-nav__item> <a href=#amazon-inspector class=md-nav__link> <span class=md-ellipsis> Amazon Inspector </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#privacy-and-compliance class=md-nav__link> <span class=md-ellipsis> Privacy and Compliance </span> </a> <nav class=md-nav aria-label="Privacy and Compliance"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aws-audit-manager class=md-nav__link> <span class=md-ellipsis> AWS Audit Manager </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aws-cloudtrail class=md-nav__link> <span class=md-ellipsis> AWS CloudTrail </span> </a> </li> <li class=md-nav__item> <a href=#security-faqs class=md-nav__link> <span class=md-ellipsis> Security FAQs </span> </a> </li> <li class=md-nav__item> <a href=#solution-design class=md-nav__link> <span class=md-ellipsis> Solution Design </span> </a> <nav class=md-nav aria-label="Solution Design"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#blocking-ip-address class=md-nav__link> <span class=md-ellipsis> Blocking IP address </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-learn-more class=md-nav__link> <span class=md-ellipsis> Security Learn more </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=security>Security<a class=headerlink href=#security title="Permanent link">&para;</a></h1> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Created Oct/2022 - Updated 10/25/2023 - Between level 100 to 400.</p> </div> <h2 id=introduction>Introduction<a class=headerlink href=#introduction title="Permanent link">&para;</a></h2> <p>With the AWS Cloud, managing security and compliance is a <a href=https://aws.amazon.com/compliance/shared-responsibility-model/ >shared responsibility</a> between AWS and the customer:</p> <ul> <li><a href=https://aws.amazon.com/security/ >AWS is responsible of security <strong>of</strong> the cloud</a> and offers the most flexible and secure cloud computing environment available today. AWS is responsible for patching their managed services and infrastructure security.</li> <li>Customers are responsible for the security <strong>in</strong> the cloud: secure workloads and applications that are deployed onto the cloud. When using EC2, we are responsible to patch OS for security (but AWS helps by providing patched AMIs, or tools such as <a href=https://aws.amazon.com/systems-manager>Systems Manager</a>, or <a href=https://aws.amazon.com/inspector/ >Inspector</a> for continuous vulnerability testing).</li> </ul> <p>AWS runs highly secured data centers. Multiple geographic regions and Availability Zones allow customers to remain resilient in the face of most failure modes, from system failure to natural disasters.</p> <p>For highly regulated industry, AWS helps by getting more than 50 certifications for the infrastructure, globally but also regionaly for specific countries. At global, these include the <a href=https://www.iso.org/isoiec-27001-information-security.html>ISO 27001</a>, SOC 1 and 2 certifications. For regional in the USA, AWS aligns with <a href=https://www.cisa.gov/federal-information-security-modernization-act>FISMA</a> and <a href=https://www.gsa.gov/technology/government-it-initiatives/fedramp>FedRAMP</a>, in UK with Cyber Essentials, in Australia with IRA... The audits are done by a 3nd party and we can find reports in <a href=https://aws.amazon.com/artifact/ >aws/artifact</a>.</p> <p><a href=https://aws.amazon.com/financial-services/security-compliance/compliance-center/ >AWS Compliance Center is a central location to research cloud-related regulatory requirements</a></p> <p>Fine-grain identity and access controls combined with continuous monitoring for near real-time security information (<a href=https://aws.amazon.com/cloudtrail/ >CloudTrail</a>) ensures that the right resources have the right access at all times, wherever the information is stored</p> <p>The following figure illustrates the AWS security domains and the services to support those domains:</p> <p><img alt src=../images/security/aws-security-domains.png width=800></p> <p>Security scope needs to address all those domains, and leverage the four core security services: <code>Security Hub, GuardDuty, Shield Advanced, KMS</code>.</p> <hr> <h2 id=1-identity>1- Identity<a class=headerlink href=#1-identity title="Permanent link">&para;</a></h2> <h3 id=iam-identity-and-access-management><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html>IAM Identity and Access Management</a><a class=headerlink href=#iam-identity-and-access-management title="Permanent link">&para;</a></h3> <ul> <li>Helps to control access to AWS services, for <strong>identities</strong> like users or other services, via console, CLI or SDK.</li> </ul> <p><img alt src=../images/security/iam-authentication.png width=800></p> <ul> <li>IAM is a global service, defined at the account level, cross regions.</li> <li>IAM helps defining users (physical person), groups and roles, permissions (policies) and control access to <strong>Resources</strong>.</li> <li>An AWS account is not the same as a user. The users are defined in IAM for development or SRE needs. Identity Center users are also different.</li> </ul> <p><img alt src=../images/security/iam-groups.png width=800></p> <ul> <li><strong>Resources</strong> are entities created in AWS (S3 bucket is a resource).</li> <li> <p>Users attempt to perform <strong>Actions</strong> on resources. <strong>Policy</strong> authorizes to perform action.</p> </li> <li> <p>Each account has a root user. Root user access should be set up to use Multi Factor Authentication (MFA) and use complex password. Do not delete root user. But do not use root user, create a user with administrator role.</p> </li> <li>Administrator users are part of an admin group with admin priviledges, like <code>AdministratorAccess</code> policy.</li> <li>Assign users to groups (<code>admin</code> and <code>developers</code>) and assign policies to groups and not to individual user.</li> <li>Groups can only contain users, not other groups.</li> <li>Users can belong to multiple groups.</li> <li>A classical use case: Create the user, create a group for each department, create and attach an appropriate policy to each group, and place each user into their departmentâ€™s group. When new team members are onboarded, create their user and put them in the appropriate group. If an existing team member changes departments, move their user to their new IAM group.</li> <li>AWS Account has a unique ID but can be set with an alias. The console URL includes the user alias.</li> <li><strong>Principal</strong>: A person or application that can make a request for an action or operation on an AWS resource. Role sessions, IAM users, federated users, and root users are principals that make requests.</li> <li><strong>Identity-based policies</strong>: Policies that are attached to an IAM user, group, or role. These policies let us specify what that identity can do (its permissions). Identity-based policies can be managed or inline(not shareable).</li> <li><strong>Resource-based policies</strong>: Policies that are attached to a resource. Not all AWS resources authorize such policies.</li> <li><strong>IAM Roles</strong> are used to get temporary credential, via <a href=#aws-security-token-service-api>STS</a>, to do something on other services. EC2 has <strong>instance role</strong> to access remote services. Service roles is also used from service to service authorization, and finally Cross account roles are used to do action within another AWS Account.</li> </ul> <details class=-> <summary>Identity Center</summary> <p>This is another service to manage user for single sign on on applications deployed on AWS. This is in Identity Center that we define Organizations.</p> </details> <h4 id=multi-factor-authentication-mfa>Multi Factor Authentication - MFA<a class=headerlink href=#multi-factor-authentication-mfa title="Permanent link">&para;</a></h4> <ul> <li> <p>Multi Factor Authentication is used to verify a human is the real user of a service</p> <ul> <li>Always protect root account with MFA. </li> <li>MFA = password + device we own. </li> <li>The device could be a universal 2<sup>nd</sup> factor security key. (ubikey) </li> </ul> </li> <li> <p><a href=https://authy.com/ >Authy</a> is a multi-device service with free mobile app. We can have multiple users on the same device.</p> </li> </ul> <h3 id=security-policies>Security Policies<a class=headerlink href=#security-policies title="Permanent link">&para;</a></h3> <ul> <li>Security Policies are written in JSON, and define permissions <code>Allow</code>, <code>Deny</code> for users or roles to perform action on AWS services, for an IAM identity such a user, user groups or role...</li> <li><strong>AWS Managed policy</strong> (e.g. AdminstratorAccess policy) are predefined by AWS. </li> <li>Policies defined by customer (<strong>Customer managed</strong>)</li> <li><strong>Inline policies</strong> assigned to one user or role and not shareable</li> <li> <p><strong>Resource based policies</strong> for access resources like S3 bucket.</p> <p><img alt src=../diagrams/security/resource-based-policy.drawio.png></p> </li> <li> <p>Policy applies to <strong>Principal</strong>: an account | user | role, list the <strong>actions</strong> (what is allowed or denied) on the given <strong>resources</strong>.</p> </li> <li> <p>It must define an ID, a version and one or more statement(s). The following policy authorizes to create any lambda function. (resource = '*' is to support any resource arn, so here any function).</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>                </span><span class=s2>&quot;lambda:CreateFunction&quot;</span>
<span class=w>            </span><span class=p>],</span>
<span class=w>            </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;*&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nt>&quot;Condition&quot;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=p>{}</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div> </li> </ul> <p>The condition part can reference specific principals or resource, and use the format:</p> <div class=highlight><pre><span></span><code><span class=nt>&quot;Condition&quot;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nt>&quot;{condition-operator}&quot;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nt>&quot;{condition-key}&quot;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=s2>&quot;{condition-value}&quot;</span><span class=w> </span><span class=p>}}</span>
</code></pre></div> <ul> <li> <p>Another example to control access to IAM itself:</p> <p><img alt src=../images/security/aws-policy.png width=800></p> </li> <li> <p>Use the <code>Least privilege permission</code> approach: Give users the minimal amount of permission they need, to do their job.</p> </li> <li>Developer may have the AWS managed policy name: <code>PowerUserAccess</code> to enable them to create and configure resources and services that support AWS aware application development.</li> <li>As soon as there is one <code>deny</code> in the chain of policy evaluation, any <code>allows</code> will not work. See the diagram below from <a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_evaluation-logic.html>the product documentation</a> to review the decision flow for resource access authorization:</li> </ul> <p><img alt src=https://docs.aws.amazon.com/images/IAM/latest/UserGuide/images/PolicyEvaluationHorizontal111621.png></p> <details class="- exercise"> <summary>IAM policy evaluation workshop</summary> <p>The <a href=https://catalog.us-east-1.prod.workshops.aws/workshops/6dc3124a-6bd4-46eb-b5c4-be438a82ba3d/en-US>IAM policy evaluation workshop</a> is useful to understand the policy evaluation. The <a href=https://github.com/jbcodeforce/aws-studies/tree/main/labs/security/iam/lab-template.yaml>CF template is in labs/security/iam</a>. The lab illustrates the Role defined and assigned to the EC2 running Cloud9, cannot list S3 bucket, but 1/ adding an inline identity-based policy will get it working. There is no resource based policy on S3. The session policy allows all access and acts as a pass through. 2/ Adding a resource-based policy on S3 denies access to the role. The role used in the workshop has action like: <code>s3:GetBucketPolicy</code> and <code>s3:PutBucketPolicy</code>, so it can create policies. Deleting the identity policy on the role and then adding a resource-policy on s3 bucket like the one below, lets the role accessing the bucket.</p> <div class=highlight><pre><span></span><code><span class=nt>&quot;Sid&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;AccessToLabBucket&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;Principal&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nt>&quot;AWS&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;$IAM_LAB_ROLE_ARN&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;s3:ListBucket&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:s3:::$S3_LAB_BUCKET_NAME&quot;</span>
</code></pre></div> <p>In Part 2 of the lab, it demonstrates that a resource based policy with an Allow on all Principals, bypasses the permission boundary, so exits at column 3 in figure above. While a deny on permission boundary with a resource-based policy (This works because we are in the same AWS account):</p> <div class=highlight><pre><span></span><code><span class=w>  </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;Sid&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;AccessToLabBucket&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;Principal&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nt>&quot;AWS&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;$IAM_LAB_ROLE_ARN&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;s3:ListBucket&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:s3:::$S3_LAB_BUCKET_NAME&quot;</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=err>Whe</span><span class=kc>n</span><span class=w> </span><span class=err>evalua</span><span class=kc>t</span><span class=err>i</span><span class=kc>n</span><span class=err>g</span><span class=w> </span><span class=err>policies</span><span class=w> </span><span class=kc>f</span><span class=err>or</span><span class=w> </span><span class=err>a</span><span class=w> </span><span class=err>cross</span><span class=mi>-</span><span class=err>accou</span><span class=kc>nt</span><span class=w> </span><span class=err>reques</span><span class=kc>t</span><span class=p>,</span><span class=w> </span><span class=kc>t</span><span class=err>he</span><span class=w> </span><span class=err>resource</span><span class=mi>-</span><span class=err>based</span><span class=w> </span><span class=err>policy</span><span class=w> </span><span class=err>a</span><span class=kc>n</span><span class=err>d</span><span class=w> </span><span class=err>all</span><span class=w> </span><span class=err>policies</span><span class=w> </span><span class=err>a</span><span class=kc>tta</span><span class=err>ched</span><span class=w> </span><span class=kc>t</span><span class=err>o</span><span class=w> </span><span class=kc>t</span><span class=err>he</span><span class=w> </span><span class=err>pri</span><span class=kc>n</span><span class=err>cipal</span><span class=w> </span><span class=err>maki</span><span class=kc>n</span><span class=err>g</span><span class=w> </span><span class=kc>t</span><span class=err>he</span><span class=w> </span><span class=err>reques</span><span class=kc>t</span><span class=w> </span><span class=err>are</span><span class=w> </span><span class=err>evalua</span><span class=kc>te</span><span class=err>d</span><span class=w> </span><span class=err>separa</span><span class=kc>tel</span><span class=err>y</span><span class=w> </span><span class=err>a</span><span class=kc>n</span><span class=err>d</span><span class=w> </span><span class=err>bo</span><span class=kc>t</span><span class=err>h</span><span class=w> </span><span class=err>mus</span><span class=kc>t</span><span class=w> </span><span class=err>allow</span><span class=w> </span><span class=err>access</span><span class=p>,</span><span class=w> </span><span class=err>regardless</span><span class=w> </span><span class=err>o</span><span class=kc>f</span><span class=w> </span><span class=err>wha</span><span class=kc>t</span><span class=w> </span><span class=err>value</span><span class=w> </span><span class=err>is</span><span class=w> </span><span class=err>used</span><span class=w> </span><span class=err>i</span><span class=kc>n</span><span class=w> </span><span class=kc>t</span><span class=err>he</span><span class=w> </span><span class=err>Pri</span><span class=kc>n</span><span class=err>cipal</span><span class=w> </span><span class=err>eleme</span><span class=kc>nt</span><span class=w> </span><span class=err>o</span><span class=kc>f</span><span class=w> </span><span class=kc>t</span><span class=err>he</span><span class=w> </span><span class=err>resource</span><span class=mi>-</span><span class=err>based</span><span class=w> </span><span class=err>policy.</span>
</code></pre></div> </details> <ul> <li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_access-advisor.html?icmpid=docs_iam_console">Access Advisor</a> helps to see permission granted to a user or role, and when services were last accessed. It helps to identify unused permissions so that we can remove them.</li> <li><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/access-analyzer-getting-started.html>Access Analyzer</a>: Analyze resources (S3 buckets, IAM roles, KMS keys, Lambda fct, SQS Queues, secrets) that are shared with external entity.</li> <li>Policy may define the password type <code>&gt; Account settings &gt; Password policy</code>, and when users are allowed to change the password.</li> <li>Inline policy can be defined at the user level, but it is recommended to use Group and Group level policies. As user can be part of multi groups, she/he will heritate to the different policies of those groups.</li> <li>IAM is not used for website authentication and authorization. AWS Cognito is a better fit for that.</li> <li>For identity federation, use SAML standard.</li> <li>We can test Policies with the <a href=https://policysim.aws.amazon.com/home/index.jsp?#>policy simulator</a>.</li> <li> <p>We can update a policy attached to a role and it takes immediate effect.</p> </li> <li> <p>We can attach &amp; detach roles to running EC2, without having to stop and restart it.</p> </li> <li>A policy has a max character count size around 10,240. </li> <li> <p>IAM policies can use variables, like <code>$aws:username</code>, and Tags like <code>aws:PrincipalTag/key-name</code>.</p> </li> <li> <p>Very interesting <a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_examples.html>examples of IAM identity based policies.</a></p> </li> </ul> <h3 id=iam-roles><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html>IAM Roles</a><a class=headerlink href=#iam-roles title="Permanent link">&para;</a></h3> <p>An IAM role is an IAM identity (as a user is) that we can create in our account to grant it specific permissions.</p> <ul> <li> <p><a href=https://docs.aws.amazon.com/bedrock/latest/userguide/security-iam.html>Found this summary very good</a></p> </li> <li> <p>To get AWS services doing work on other service, we need to define IAM Role and policies. Roles are assigned per application, or per EC2 or lambda function... A lot of roles are predefined and can be reused. We can also define new role for any service intance we create. Here are example of predefined service roles:</p> <p><img alt src=../images/security/iam-roles.png></p> </li> <li> <p>A role is intended to be <strong>assumable</strong> by anyone who needs it. This means another identity will identify itself to be that role. The following diagram is used for Account A to access S3 bucket in Account B via a role defined in Account B with policies to access S3.</p> <p><img alt src=../diagrams/security/basic-access.drawio.png></p> </li> <li> <p>In the role definition there is <code>Link to switch roles in console</code> URL that permits to assume the role for a given user.</p> </li> <li> <p>There is no password for a role, when a service assumes a role, IAM dynamically provides temporary security credentials that expire after a defined period of time, between 15 minutes to 36 hours. Temporary Security Credentials (consisting of access key id, secret access key and a security token). The credentials are coming from AWS Security Token Service via AssumeRole API. It solves use cases like cross account access and single sign-on to AWS.</p> <p><img alt src=../diagrams/security/cross-account-access.drawio.png></p> </li> <li> <p>When a user, app, service, assumes a role, it gave up the original permissions it had and takes the permissions assigned to the role. While with resource based policy the principal doesn't have to give up permissions.</p> </li> <li> <p>The assumed role needs to trust the assuming identity explicitly via a <strong>Trust relationship</strong> declaration: The following statement enables EC2 to assume the role to which this trust relationship is attached to:</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nt>&quot;Principal&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nt>&quot;Service&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;ec2.amazonaws.com&quot;</span>
<span class=w>            </span><span class=p>},</span>
<span class=w>            </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;sts:AssumeRole&quot;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div> </li> <li> <p>So when defining a role, we should define the trusted entity (principals), that may use this role, and then a policy to define what actions can be done on the service (in the role's permission settings). Trust relationship is used to share resources between accounts, it is a bidirectional relationship. Account owner may authorize to have users assuming a given role.</p> </li> <li>A role that a service assumes to perform actions on our behalf is called a <strong>service role</strong>.</li> <li>A <strong>service-linked role</strong> is a type of service role that is linked to an AWS service. They are own by the services, be visible in our AWS account but not editable.</li> <li>A <a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2.html>role can be attached to an EC2 instance</a>, and so any applications running on that EC2 instance, can get temporary AWS credentials to access permitted services. The role supplies temporary permissions that applications can use when they make calls to other AWS resources:</li> </ul> <p><img alt src=../images/security/ec2-role-binding.png width=500></p> <details class="- example"> <summary>EC2 control with IAM role</summary> <p>When connected to an EC2 machine via ssh or using EC2 Instance Connect tool, we need to set an IAM role to define who can use the EC2 and what command they can do within EC2. Inside the EC2 shell, a command like <code>aws iam list-users</code> will not work until a role is attached to EC2 with a policy to autorize IAM actions. For example, the following <code>DemoEC2Role</code> role is defined to let read-only IAM access:</p> <p><img alt src=../images/security/aws-iam-role.png width=800></p> <p>This role is then used in the EC2 / Security &gt; attach IAM role, and now read-only commands with <code>aws iam</code> will execute successfully inside this EC2.</p> </details> <details class="- example"> <summary>IAM user and role with CDK</summary> <p>Example of creating a user to get EC2 full access via a role (see code under <a href=https://github.com/jbcodeforce/aws-studies/tree/main/labs/cdk/iam-user>labs/cdk/iam-user</a>):</p> <div class=highlight><pre><span></span><code><span class=n>user</span> <span class=o>=</span> <span class=n>iam</span><span class=o>.</span><span class=n>User</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span>
                <span class=s2>&quot;Julie&quot;</span><span class=p>,</span>
                <span class=n>user_name</span><span class=o>=</span><span class=s2>&quot;Julie&quot;</span><span class=p>,</span>
                <span class=n>password</span><span class=o>=</span><span class=n>SecretValue</span><span class=o>.</span><span class=n>unsafe_plain_text</span><span class=p>(</span><span class=s2>&quot;Passw0rd!&quot;</span><span class=p>)</span>
                <span class=p>)</span>

<span class=n>role</span> <span class=o>=</span> <span class=n>iam</span><span class=o>.</span><span class=n>Role</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=s2>&quot;EC2FullAccess&quot;</span><span class=p>,</span>
                <span class=n>role_name</span><span class=o>=</span><span class=s2>&quot;EC2FullAccess&quot;</span><span class=p>,</span>
                <span class=n>description</span><span class=o>=</span><span class=s2>&quot;A role to allow specified user to do EC2 work&quot;</span><span class=p>,</span>
                <span class=n>assumed_by</span><span class=o>=</span><span class=n>user</span><span class=p>,</span>
                <span class=n>managed_policies</span><span class=o>=</span><span class=p>[</span><span class=n>iam</span><span class=o>.</span><span class=n>ManagedPolicy</span><span class=o>.</span><span class=n>from_aws_managed_policy_name</span><span class=p>(</span><span class=s2>&quot;AmazonEC2FullAccess&quot;</span><span class=p>)])</span>
</code></pre></div> </details> <details class="- example"> <summary>IAM user and role using SDK</summary> <p><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/example_iam_CreateRole_section.html>See product documentation</a> and the following <a href=https://github.com/jbcodeforce/aws-organization-play>personal AWS Organization play examples</a>.</p> </details> <details class="- example"> <summary>Lamba to access S3 bucket</summary> <p>We want to implement a lambda function, that will access one S3 bucket to read files and another s3 bucket to put objects. We need a new role as illustrated in following figure, with permission to execute on lambda service, trace with XRay and R/W to S3 policy.</p> <p><img alt src=../images/security/s3-role.png width=1000></p> <p>See the policy examples defined in <a href=https://github.com/jbcodeforce/aws-studies/blob/main/labs/lambdas/s3-lambda/s3-read-write-permission.txt>labs/s3-lambda</a>. <code>AWSLambdaBasicExecutionRole</code> is for logs, <code>AWSXRayDaemonWriteAccess</code> for the function to put traces into CloudWatch XRay.</p> <p>When defining the Lambda function we select the role defined with the expected permissions so the function can access other services.</p> </details> <details class="- example"> <summary>Playing with Organizations</summary> <p><a href=https://github.com/jbcodeforce/aws-organization-play.git>See readme and code in the aws-organization-play repo</a> with assume role between accounts.</p> </details> <h4 id=resource-based-policy>Resource-based policy<a class=headerlink href=#resource-based-policy title="Permanent link">&para;</a></h4> <p>When user, application or service assumes a role, it takes the permissions assigned to the role, and <strong>looses</strong> its original permissions. While when we use resource-based policy, the principal doesn't have to give up his permissions. For example if a user in Account A needs to scan DynamoDB table in account A and dumps it in S3 bucket in account B, then it is important to use resource-based policy for S3 bucket, so user does not loose its access to dynamoDB.</p> <h4 id=attribute-based-access-control>Attribute-based access control<a class=headerlink href=#attribute-based-access-control title="Permanent link">&para;</a></h4> <p>Attribute-based access control (ABAC) helps to determine access to resources based on attributes of the user, resource, application' states and environment conditions. An ABAC policy could allow access to a payment processing endpoint only for users in the finance department during business hours.</p> <p>Attributes may come from multiple sources: IAM tags, STS session tags, resource tags.</p> <p>ABAC gives a lot of flexibility compared to traditional IAM policies by enabling dynamic, context-aware authorization decisions: who is the user? What are they trying to access? How are they trying to access it? What environment are they in? </p> <p>The disadvantage to using the traditional RBAC model is that when employees add new resources, you must update policies to allow access to those resources. </p> <p>Here is an example of such policy:</p> <div class=highlight><pre><span></span><code><span class=p>{</span><span class=w> </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=p>,</span><span class=w> </span>
<span class=w>  </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span>
<span class=w>    </span><span class=p>{</span><span class=w> </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span><span class=w> </span>
<span class=w>      </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;s3:ListBucket&quot;</span><span class=p>,</span><span class=w> </span>
<span class=w>      </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:s3:::example_bucket&quot;</span><span class=p>,</span><span class=w> </span>
<span class=w>      </span><span class=nt>&quot;Condition&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w> </span>
<span class=w>        </span><span class=nt>&quot;StringEquals&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nt>&quot;aws:PrincipalOrgID&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;o-12345&quot;</span><span class=p>,</span><span class=w> </span><span class=nt>&quot;aws:PrincipalTag/Department&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Finance&quot;</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>}</span><span class=w> </span>
<span class=w>    </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div> <p><a href=https://docs.aws.amazon.com/verifiedpermissions/latest/userguide/policies_examples-abac.html>ABAC policy examples.</a></p> <p>sts:TagSession permission allows an IAM user or role to pass session tags when assuming a role or federating users. Session tags are custom attributes that get attached to the resulting temporary security credentials</p> <p>Session tags are key-value pairs that can be used to organize or track assumed role sessions.</p> <p>Session tags get returned with the AssumeRole response and can then be referenced in IAM policies or AWS Config rules. This allows conditional access based on session attributes. The maximum number of session tags per response is 10, with a maximum key and value size of 128 bytes each.</p> <h4 id=some-important-articles>Some important articles<a class=headerlink href=#some-important-articles title="Permanent link">&para;</a></h4> <ul> <li><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/getting-started.html>Learn to create a user, a role, using the console</a>.</li> <li><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorials.html>IAM tutorials</a> with matching aws cli iam scripts in <a href=https://github.com/jbcodeforce/aws-studies/tree/main/labs/security/iam>labs/security/iam</a></li> <li><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use.html>Using IAM role product documentation</a></li> <li><a href=https://aws.amazon.com/blogs/security/use-iam-roles-to-connect-github-actions-to-actions-in-aws/ >Use IAM roles to connect GitHub Actions to actions in AWS</a> to get an example of trusting an external system to access AWS services via our AWS account.</li> <li><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_evaluation-logic.html>Policy evaluation logic</a></li> </ul> <h3 id=permissions-boundary>Permissions boundary<a class=headerlink href=#permissions-boundary title="Permanent link">&para;</a></h3> <p>Set a permissions boundary to control the maximum permissions a user can have using identity-based policies. This is defined at user's or role level, and we define a customer managed policy or a AWS managed policy, for example, to authorize the user to do anything on EC2, CloudWatch or S3. Permissions boundary limits the user's permissions but does not provide permissions on its own.</p> <p>The effective permission of a user is the join between Organization SCP, Permissions Boundary, and identity-based policies.</p> <p><img alt src=../diagrams/effective-perm.drawio.png width=600></p> <details class="- exercise"> <summary>IAM policy evaluation workshop</summary> <p>The <a href=https://catalog.us-east-1.prod.workshops.aws/workshops/6dc3124a-6bd4-46eb-b5c4-be438a82ba3d/en-US>IAM policy evaluation workshop</a> lab2 demonstrates permission boundary.</p> </details> <p>They are used to:</p> <ul> <li>Delegate responsibilities to non-admin users within their permission boundaries to create specific resources, like an IAM user.</li> <li>Allow developers to self-assign policies and manage their own permissions, while making sure they can increase their privileges (to an admin user).</li> <li>Restrict one user.</li> </ul> <p><a href=https://aws.amazon.com/blogs/security/delegate-permission-management-to-developers-using-iam-permissions-boundaries/ >See this blog as a good example of things to do.</a>.</p> <h3 id=security-tools>Security tools<a class=headerlink href=#security-tools title="Permanent link">&para;</a></h3> <ul> <li>In IAM, use <code>&gt; Credentials report</code> to download account based report.</li> <li>In IAM, use <code>&gt; Users &gt; select one user and then Access Advisor tab</code>: Access Advisor shows the services that the selected user can access and when those services were last accessed.</li> <li><a href=https://aws.amazon.com/guardduty/ >Amazon GuardDuty</a> is a security tool to continuously monitor the AWS accounts, instances, containers, users, and storage for potential threats.</li> <li> <p><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/access-analyzer-getting-started.html>Access Analyzer</a>: Analyze resources (S3 buckets, IAM roles, KMS keys, Lambda fct, SQS Queues, secrets) that are shared with external entity. It uses the concept of Zone of Trust, which is an AWS account or Organization. Any potential violation is called a <strong>finding</strong>. It can be used to validate policy syntax, but to generate policy too. The diagram below illustrates how Access Analyzer can use CloudTrail logs from a lambda execution to help create an accurate IAM policy, to define accurate security scope:</p> <p><img alt src=../diagrams/security/access-analyzer.drawio.png></p> </li> </ul> <h3 id=iam-identity-center><a href=https://docs.aws.amazon.com/singlesignon/index.html>IAM Identity Center</a><a class=headerlink href=#iam-identity-center title="Permanent link">&para;</a></h3> <p>This is a single sign-on managed services for all AWS accounts within AWS Organizations, cloud applications, SAML2.0-enabled applications, EC2 Windows instances. IAM Identity Center requires AWS Organizations. When Identity Center is enabled, it creates a service-linked role in all accounts within the organization in AWS Organizations.</p> <p>By default IC has an identity store. But it can be connected to a remote directory service. The SSO works with a login, and users/groups are defined within IC store.</p> <p>AWS Organizations supports IAM Identity Center in only one AWS Region at a time. We need to delete IC if we want to use another region.</p> <p>The goal of identity federation is to get user outside of AWS, the permissions to access AWS resources into our accounts. Identity federation is supported by different solutions:</p> <ul> <li>SAML 2.0: Open standard used by many identity providers like Microsfodt Active Directory Federations Services (ADFS). We need to define a trust between the SAML 2.0 identity provider and AWS IAM, and then use <code>AssumeRoleWithSAML</code> STS API.</li> <li>Custom Identity Broker</li> <li>Web identity with Amazon Cognito</li> <li>SSO</li> </ul> <p>The identity provider can be an identity store in IAM Identity center or a 3nd party solution like an Active Directory, OneLogin, Okta...</p> <p>Permission sets are a way to define permissions centrally in IAM Identity Center so that they can be applied to all of our AWS accounts. These permission sets are provisioned to each AWS account as an IAM role.</p> <p><img alt src=../images/security/permission-set.png></p> <p>The user can access the access portal (URL like https://d-92676f0fd8.awsapps.com/start), then the account it is associated to, and the permission sets he wants to use, then he can access the AWS management console. Depending of the permission sets the user can perform different actions to services.</p> <p>A permission sets can have customer permission, defined as part of a customer managed policies.</p> <details class="- example"> <summary>Apply permission set for an SRE team</summary> <p>A SRE team needs to access different member accounts, but only to see CloudWatch log groups. To support that do:</p> <ol> <li>Create a customer managed IAM policy to allow "logs:CreateLogStream"... on specific account <code>id:log-group:*</code></li> <li>Create a permission set in IC, and use the custom permission using the policy from previous step.</li> <li>Create a group in IC: <code>operations</code></li> <li>Create a user <code>operationsUser</code> and add to the group <code>operations</code></li> <li>Select the account we want those user to access, and assign the permission set to it.</li> </ol> </details> <details class="- example"> <summary>Define attribute based access control</summary> <p>When creating a user in IC, there are attributes (tags) defined, like a Department. Those can be used to as conditions in an IAM policy, and then assigned to a permission set.</p> <div class=highlight><pre><span></span><code><span class=nt>&quot;Condition&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nt>&quot;StringEquals&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>             </span><span class=nt>&quot;ec2:ResourceTag/Department&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;${aws:PrincipalTag/Department}&quot;</span>
<span class=w>            </span><span class=p>}</span>
</code></pre></div> <p>Then enable attributes for access control, in IC settings. And use <code>Key: Department</code> and <code>Value: ${path:enterprise.department}</code></p> </details> <ul> <li><a href=https://docs.aws.amazon.com/singlesignon/latest/APIReference/welcome.html>API reference</a></li> </ul> <h3 id=aws-organizations>AWS Organizations<a class=headerlink href=#aws-organizations title="Permanent link">&para;</a></h3> <p><a href=https://us-east-1.console.aws.amazon.com/organizations>AWS Organizations</a> helps to centraly manage multiple AWS accounts, group accounts, defines security policies cross account, and simplify account creation. Using accounts helps to isolate AWS resources. It is a global service.</p> <ul> <li>We can set up a single payment method for all the AWS accounts in our organization through <strong>consolidated billing</strong>.</li> <li>It groups accounts via organizational units (OUs), on which we can define policies.</li> <li>It is well suited to define custom multi-account environments with advanced governance and management capabilities.</li> </ul> <h4 id=concepts>Concepts<a class=headerlink href=#concepts title="Permanent link">&para;</a></h4> <p><img alt src=../diagrams/organization.drawio.png width=800></p> <p><strong>Figure 5: Organization concepts</strong></p> <ul> <li>A <strong>management account</strong> is the AWS account you use to create your organization.</li> <li>An organization is a hierarchical structure (a tree) with an <strong>administrative root</strong> and Organization Units (OU), and AWS accounts.</li> <li>The <code>root</code> user is a single sign-in identity that has complete access to all AWS services and resources in any accounts.</li> <li>Organization unit (OU) contains AWS Accounts or other OUs. It can have only one parent.</li> </ul> <p><img alt src=../images/security/organization.png width=800></p> <p><strong>Figure 6: Organization Services - manage accounts</strong></p> <ul> <li>OU can be per team, per line of business.</li> <li> <p>When creating an account, the management account may use the <code>OrganizationAccountAccessRole</code> role to grant full admin permissions in the member accounts to the management account itself. It is used to perform admin tasks in the member accounts, like creating IAM users.</p> <p><img alt src=../diagrams/security/OrgAccountAccessRole.drawio.png></p> </li> <li> <p>Once account created, a user needs to go to the AWS login console (https://signin.aws.amazon.com/), use the email address and forgot password option, or use the one-time password defined during creation.</p> </li> <li>AWS Organizations uses <a href=https://docs.aws.amazon.com/organizations/latest/userguide/orgs_integrate_services.html#orgs_integrate_services-using_slrs>IAM service-linked roles</a> to enable trusted services to perform tasks on our behalf in our organization's member accounts.</li> <li>We can create <strong>Service Control Policies</strong> (SCPs) cross AWS accounts to filter which AWS services can be used for individuals or group of accounts in an OU. Explicit allow. The root OU will have <code>FullAWSAccess</code> SCP.</li> <li>AWS Organization exposes APIs to automate account management.</li> <li>Organization helps consolidating billing accross all the accounts and user can get pricing benefits from aggregate usage. Shared reserved instances and Saving Plans discounts apply across accounts. Can define Blocklist or Allowlist strategies.</li> <li>There is no cost to use AWS Organizations.</li> <li>We can invite an existing AWS account to our organization. But paymen t changes of ownership.</li> <li>There is a special feature called <code>All Features</code> to include consolidated billing, integration with AWS services and SCPs. To share a RI or Savings Plans discount with an account, both accounts must have sharing turned on.</li> <li>With Organizations, we can centrally orchestrate any AWS CloudFormation enabled service across multiple AWS accounts and regions.</li> </ul> <h4 id=advantages>Advantages<a class=headerlink href=#advantages title="Permanent link">&para;</a></h4> <ul> <li>Group resources for categorization and discovery</li> <li>Define logical boundary for security purpose.</li> <li>Limit blast radius in case of unauthorized access.</li> <li>More easily manage user access to different environments. If team A can't support team B's app, the applications should not be in the same account.</li> <li>Can use tagging for billing purpose.</li> <li>Help to bypass the limit per account, for example the number of lambda function per account.</li> <li>Enable CloudTrail for all accounts and get report in a central S3 bucket.</li> </ul> <p><img alt src=../images/security/org-policies.png width=800></p> <p><strong>Figure 7: Organization policies</strong></p> <h4 id=service-control-policies>Service Control Policies<a class=headerlink href=#service-control-policies title="Permanent link">&para;</a></h4> <p>They define the <code>maximum available</code> permissions for IAM entities in an account. SCPs are attached to the root org, OUs, or individual accounts. They are inherited. SCPs alone are not sufficient for allowing access to the accounts in our organization. Attaching an SCP to an AWS Organizations entity just defines a guardrail for what actions the principals can perform.</p> <p>We can define allowance policy on resources within the account using something like:</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>   </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot; Action&quot;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>        </span><span class=s2>&quot;ec2:*&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;ds:*&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;s3:*&quot;</span>
<span class=w>    </span><span class=p>],</span>
<span class=w>    </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;*&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;Condition&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;StringEquals&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nt>&quot;aws:RequestedRegion&quot;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&quot;eu-central-1&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;us-west-1&quot;</span><span class=w> </span><span class=p>]</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>Or denying like: (Be sure to have policy to allow "*" )</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>   </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Deny&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot; Action&quot;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>        </span><span class=s2>&quot;organizations:LeaveOrganization&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;ec2:TerminateInstances&quot;</span>
<span class=w>        </span><span class=p>,</span><span class=w> </span><span class=s2>&quot;ec2:PurchaseReservedInstancesOffering&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;ec2:ModifyReservedInstances&quot;</span>
<span class=w>    </span><span class=p>],</span>
<span class=w>    </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;*&quot;</span>
<span class=p>}</span>
</code></pre></div> <p>Account administrator must still attach identity-based policies to IAM users or roles, or resource-based policies to the resources in the accounts to actually grant permissions. The effective permissions are the logical intersection between what is allowed by the SCP and what is allowed by the identity-based and resource-based policies.</p> <p>SCP defined at the management account level has no impact as management account can do anything.</p> <p>As some AWS AI services may use the data of an account, it is possible to define OptOut policies.</p> <details class="- example"> <summary>Enforce using tags to launch EC2 instances</summary> <p>Use Organizations. Create a Service Control Policy that restricts launching any AWS resources without a tag by including the Condition element in the policy which uses the <code>ForAllValues</code> qualifier and the <code>aws:TagKeys</code> condition. <div class=highlight><pre><span></span><code><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;Sid&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;RequireTags&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Deny&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;*&quot;</span><span class=p>],</span>
<span class=w>  </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;*&quot;</span><span class=p>],</span>
<span class=w>  </span><span class=nt>&quot;Condition&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;ForAllValues:StringEquals&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;aws:TagKeys&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;TagKey1&quot;</span><span class=p>,</span><span class=s2>&quot;TagKey2&quot;</span><span class=p>]</span><span class=w> </span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>
<span class=p>}</span>
<span class=p>]</span>
</code></pre></div></p> </details> <h4 id=deeper-dive>Deeper Dive<a class=headerlink href=#deeper-dive title="Permanent link">&para;</a></h4> <ul> <li><a href=https://broadcast.amazon.com/videos/192190>Presentation on organizations</a></li> <li><a href=https://docs.aws.amazon.com/organizations/latest/userguide/orgs_introduction.html>User guide</a></li> <li><a href=https://docs.aws.amazon.com/organizations/latest/APIReference/API_Organization.html>Organization API</a></li> <li><a href=https://github.com/jbcodeforce/aws-organization-play>My Organization playground repo</a></li> <li><a href=../../playground/s3-org-billing/ >S3 storage lens with Organization playground lab</a></li> <li><a href=https://tutorialsdojo.com/aws-organizations/ >Tutorials Dojo, cheat sheet.</a></li> <li><a href=https://idm-infrastructure.awssecworkshops.com/ >Infrastructure Identity in AWS workshop</a> to use Systems Manager and IAM.</li> </ul> <details class=question> <summary>Limit creating EC2 instance without needed tag</summary> <div class=highlight><pre><span></span><code><span class=p>{</span><span class=w>   </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Deny&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;Action&quot;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=s2>&quot;ec2:RunInstances&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:ec2:*:*:instance/*&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;Condition&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;Null&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nt>&quot;aws:RequestTag/Project&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;true&quot;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div> </details> <h3 id=aws-security-token-service-api>AWS <a href=https://docs.aws.amazon.com/STS/latest/APIReference/welcome.html>Security Token Service API</a><a class=headerlink href=#aws-security-token-service-api title="Permanent link">&para;</a></h3> <p>Very important service to assume role accross accounts, within the same account, and to support identity federation:</p> <ul> <li> <p>The STS is used to request temporary, limited-privilege credentials for users, via the <code>AssumeRole</code> API.</p> <p><img alt src=../diagrams/security/sts-flow.drawio.png></p> </li> <li> <p>There is a global service https://sts.amazonaws.com endpoint with regional access endpoints too.</p> </li> <li>The API has the main action called <code>AssumeRole</code> which returns a AccessKeyId, SecretAccessKey, and SessionToken, so the requester can access AWS resources via API (but not sts getFederationToken or getSessionToken).</li> <li>To assume a role from a different account, the AWS account must be trusted by the role.</li> <li> <p>User must assume the role using the AWS management console, or using CLI, or AWS API.</p> <div class=highlight><pre><span></span><code><span class=c1># with the user key in the .aws/config</span>
aws<span class=w> </span>configure<span class=w> </span>--profile<span class=w> </span>Bill
aws<span class=w> </span>sts<span class=w> </span>assume-role<span class=w> </span>--role-arn<span class=w> </span><span class=s2>&quot;arn:aws:iam::&lt;account-id-cust-A1&gt;:role/UpdateApp&quot;</span><span class=w> </span>--role-session-name<span class=w> </span><span class=s2>&quot;Bill-Update&quot;</span>
</code></pre></div> </li> <li> <p>STS offers the ability to revoke active session and credentials for a role, by adding time statement within a policy or by using API <code>AWSRevokeOlderSessions</code>.</p> </li> <li>When the AWS account is owned by 3nd party (not part of our zone of trust), STS should use an <code>externalID</code>, which is a secret between our account and the 3nd party to uniquely associate a role with the 3nd party. This id is used during the assumeRole API call to ensure this is the correct account and 3nd party, to avoid the confused deputy issue.</li> <li>When doing the API call, we can pass session policies and the returned permissions are the intersection of the role's identity-based policy and the session policies.</li> <li>Session policies are advanced policies that we pass as a parameter when we programmatically create a temporary session for a role or federated user.</li> <li>We can pass a single JSON policy document to use as an inline session policy, or pass 10 managed policy ARNs</li> <li>STS stores the data relating to the tags, policies, and ARNs within the AWS session token. All this data counts towards the PackedPolicySize limit. Inline session policies and session tags are serialized and compressed in the session token. <a href=https://repost.aws/knowledge-center/iam-role-aws-sts-error>See this re:Post note</a></li> <li> <p>The plaintext to reference ARN or pass inline policy is limited to 2048 chars. <a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_iam-quotas.html>Size limites.</a>.</p> </li> <li> <p><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/id_session-tags.html>Session tags</a> are (key-value pairs) passed to the assumeRole API. Tag are added (50 tags max) to the session to control access to resources or to control what tags can be passed into a subsequent session. They are normally used for attribute-based access control (ABAC).</p> </li> </ul> <p><a href=https://github.com/jbcodeforce/aws-studies/tree/main/labs/security/session.py>See code example to get a token for a role and control access via session policies</a></p> <h3 id=amazon-cognito><a href=https://docs.aws.amazon.com/cognito/latest/developerguide/what-is-amazon-cognito.html>Amazon Cognito</a><a class=headerlink href=#amazon-cognito title="Permanent link">&para;</a></h3> <p>Amazon Cognito is a managed service which offers Authentication and Authorization features, it has <strong>User pools</strong> and <strong>Identity pools</strong>. It is scalable and highly available. Allows user to add user registration, sign in, and define access control.</p> <ul> <li>Supports standards based identity providers like OAuth 2.0, SAML, OIDC.</li> <li><strong>User pools</strong> are user directories that provide sign-up and sign-in options for our apps or mobile users. </li> <li>User pool is for sign-in functionality, and it integrates with API Gateway and ALB.</li> <li><strong>Identity pools</strong> provide AWS credentials to grant our users access to our APIs, other AWS services via IAM permissions.</li> </ul> <p><img alt src=https://docs.aws.amazon.com/images/cognito/latest/developerguide/images/scenario-cup-cib2.png width=500></p> <ul> <li>Free tier of 50,000 MAUs for users who sign in directly to Cognito User Pools and 50 MAUs for users federated through SAML 2.0 based identity providers.</li> <li>Users can sign in through social identity providers like Google, Facebook, and Amazon. They can also sign in through enterprise providers like ADFS and Okta with SAML 2.0 and OpenID Connect authentication.</li> <li>Use Amazon Cognito's built-in UI and options for federating with multiple identity providers to add user sign-in, sign-up into an application. </li> <li>use <a href=https://docs.amplify.aws/ >AWS Amplify</a> and the <a href=https://docs.amplify.aws/start/ >aws-amplify-vue</a> module to provide basic user sign up, sign in, and sign out functionality.</li> </ul> <h4 id=examples>Examples<a class=headerlink href=#examples title="Permanent link">&para;</a></h4> <ul> <li>Configure how user login:</li> </ul> <p><img alt src=../images/security/cognito-conf-1.png width=800></p> <ul> <li>Then define if we want to use MFA, get an option to reset password..</li> <li>Configure sign-up and message delivery. We can disable auto sign-up and sending email.</li> </ul> <h3 id=resource-access-manager><a href=https://aws.amazon.com/ram/ >Resource Access Manager</a><a class=headerlink href=#resource-access-manager title="Permanent link">&para;</a></h3> <ul> <li><strong>Goal</strong>: share resources with any AWS accounts. It avoid declaring duplicate resources within multiple accounts.</li> <li>No additional charge</li> <li>Share CIDR blocks via managed prefix list, so other account can define security policies using the lists</li> <li> <p>Share VPC subnets, Transit Gateway, Route 53 outbound resolver</p> </li> <li> <p><a href=https://tutorialsdojo.com/aws-resource-access-manager/ >Cheat Sheet.</a></p> </li> <li><a href=https://aws.amazon.com/ram/ >Product Doc</a></li> <li><a href=https://aws.amazon.com/ram/faqs/ >FAQ</a></li> </ul> <h3 id=aws-control-tower><a href=https://docs.aws.amazon.com/controltower/latest/userguide/what-is-control-tower.html>AWS Control Tower</a><a class=headerlink href=#aws-control-tower title="Permanent link">&para;</a></h3> <p>AWS Control Tower orchestrates other services like AWS Organizations, IAM identity center, Service Catalog. It helps to set up and to govern <strong>multi-account</strong> environments to avoid them to drift from best practices. Drift may happen when we create an account outside of Control Tower.</p> <p>It uses the concepts of <strong>Landing zone</strong> as the multi-account environment. When creating a landing zone, it creates a <code>Security</code> OU with the log archive account, and the security audit account.</p> <p><img alt src=../diagrams/security/tower-1.drawio.png></p> <p><strong>controls</strong> or guardrails which are rule to provide governance for the environment. <strong>Detective Controls</strong> detect noncompliant resources in our accounts and provide alerts through the Control Tower dashboard. They are implemented in <em>AWS Config</em> rules. <strong>Proactive Controls</strong> check compliance of the resources before they are provisioned and are implemented using <em>CloudFormation hooks</em> and Guard rules. <strong>Preventive Controls</strong> prevent actions from occurring and are implemented as <em>Service Control Policies</em> (SCPs) attached to the OUs.</p> <details class="- info"> <summary>Control example</summary> <p>If you enable the detective control Detect whether public write access to Amazon S3 buckets is allowed on an OU, you can determine whether a user would be permitted to have read access to any S3 buckets for any accounts under that OU.</p> </details> <p><strong>Account Factory</strong> is a configurable account template that helps to standardize the provisioning of new accounts with pre-approved account configurations (VPC default, subnets, regions...)</p> <p>It runs on top of Organization and leverages SCPs for preventative guardrails and AWS Config for detective guardrails.</p> <p>Detect policy violations and remediate them.</p> <p>It uses Service Catalog to provision new AWS accounts.</p> <p>AWS Control Tower aggregates information from all accounts into the organization trail and delivers the logged information to a specified Amazon S3 bucket.</p> <p>AWS Control Tower provides us with over 360 controls out-of-the-box to support the distinct security requirements of our workloads.</p> <p>No additional charge exists for using AWS Control Tower. We only pay for the AWS services enabled by AWS Control Tower, and the services we use in our landing zone.</p> <ul> <li><a href=https://catalog.workshops.aws/control-tower>Control Tower workshop</a></li> <li><a href=https://docs.aws.amazon.com/whitepapers/latest/organizing-your-aws-environment/appendix-e-establish-multi-account.html#example-workloads-flat-structure>Flat multi-account environment</a></li> <li><a href=https://docs.aws.amazon.com/whitepapers/latest/organizing-your-aws-environment/appendix-c-worksheet-for-identifying-attributes-of-workload-hosting-environments.html>Organizing Environments</a></li> </ul> <hr> <h2 id=2-data-protection>2- Data Protection<a class=headerlink href=#2-data-protection title="Permanent link">&para;</a></h2> <h3 id=encryption>Encryption<a class=headerlink href=#encryption title="Permanent link">&para;</a></h3> <p>Encryption is widely available through a lot of services and features on top of the platform. We will be able to develop application that can encrypt data at rest, or in transit as it flows over the network between services. S3 storage or EBS block attached storage, have a single click option to do encryption at rest with keys (using KMS or S3).</p> <p><img alt src=../images/security/EBS-encryption-rest.png width=700></p> <p><strong>Figure 1: Encryption settings for EBS volume, using KMS</strong></p> <h3 id=kms><a href=https://docs.aws.amazon.com/kms/latest/developerguide/overview.html>KMS</a><a class=headerlink href=#kms title="Permanent link">&para;</a></h3> <p>As a managed service, <a href=https://aws.amazon.com/kms/ >AWS Key Management Service</a>, helps centrally managing our own keys material or the one created by AWS service. User controls access and usage of the keys.</p> <p>A KMS key is a logical representation of a cryptographic key. In addition to the key material used in cryptographic operations, a KMS key includes metadata, such as the key ID, key policy, creation date, description, and key state.</p> <p>With client side encryption, the data is encrypted by the client, and never decrypted by the Server. Only client with the data key can decrypt the data.</p> <p><img alt src=../images/security/kms-1.png width=700></p> <p><strong>Figure 2: KMS &amp; AWS keys</strong></p> <ul> <li>Integrated with IAM and most AWS services (EBS,S3, RDS, SSM...). The keys never leave AWS.</li> <li>Audit KMS Key usage using Amazon CloudTrail.</li> <li> <p>Two types of KMS Keys:</p> <ul> <li>Symmetric (AES 265 bits) is a single key used to encrypt and decrypt data. Must call KMS API to use it.</li> <li>Asymmetrics (RSA, ECC key pairs) - Public key to encrypt and private key to decrypt. Used to encrypt outside of AWS, with no KMS API access.</li> </ul> </li> <li> <p>There are different types of KMS keys:</p> <ul> <li>Customer managed keys: full control to end-user to create, manage and use the key.</li> <li>AWS managed keys by AWS services within our account, like S3, EBS, redshift</li> <li>AWS owned keys used for AWS services managed services.</li> </ul> <p><img alt src=../images/security/kms-cmk.png width=600></p> </li> <li> <p>The Key material Origin is used to identify the source of the key. The Origin can be KMS, or an external service outside AWS but imported inside KMS, or a Custom Key Store which is a <a href=#aws-cloudhsm>AWS CloudHSM</a> cluster managed by us, and where KMS creates the key but let the external key store to manage it. </p> </li> <li> <p>Finally a Key source could be completely external, and supports the Bring Your Own Key use case. The key needs to be a 256-bit symmetric key. The process looks like in the figure below:</p> <p><img alt src=../diagrams/security/external-key-src.drawio.png></p> </li> <li> <p>For AWS managed keys, they are automatically rotated every year.</p> </li> <li>KMS Keys are <strong>per region</strong>. But when doing snapshot of a EBS volume and moving it to another region, AWS will reencrypt the data with a KMS key from the target region automatically. </li> <li>KMS Key policies help to control who (users, roles ) can access the KMS keys. There is one policy per key. Without permission from the key policy, IAM policies that allow permissions to access the key have no effect. We need both. See <a href=https://docs.aws.amazon.com/kms/latest/developerguide/key-policy-default.html#key-policy-default-allow-root-enable-iam>the product doc.</a></li> <li>Key policies are used to do cross account access: the copy of a encrypted snapshot done from origin account to the target account will use this policy to access the key to decrypt the snapshot, and then will encrypt the copy with a new private key within the target account.</li> </ul> <p><img alt src=../images/security/kms-2.png width=800></p> <p><strong>Figure 3: AWS key for S3 encryption, with Key policy</strong></p> <ul> <li> <p>To encrypt a local file using a symmetric Key in KMS (referenced as <code>alias/jb-key</code>), we can use the CLI like:</p> <div class=highlight><pre><span></span><code>aws<span class=w> </span>kms<span class=w> </span>encrypt<span class=w> </span>--key-id<span class=w> </span>alias/jb-key<span class=w> </span>--plaintext<span class=w> </span>fileb://ExampleSecretFile.txt<span class=w> </span>--output<span class=w> </span>text<span class=w> </span>--query<span class=w> </span>CiphertextBlob<span class=w>  </span>--region<span class=w> </span>eu-west-2<span class=w> </span>&gt;<span class=w> </span>ExampleSecretFileEncrypted.base64
</code></pre></div> </li> <li> <p>To share the encrypted file, we can do: </p> <div class=highlight><pre><span></span><code>cat<span class=w> </span>ExampleSecretFileEncrypted.base64<span class=w> </span><span class=p>|</span><span class=w> </span>base64<span class=w> </span>--decode<span class=w> </span>&gt;<span class=w> </span>ExampleSecretFileEncrypted
</code></pre></div> </li> <li> <p>Then to decrypt this file using KMS:</p> <div class=highlight><pre><span></span><code>aws<span class=w> </span>kms<span class=w> </span>decrypt<span class=w> </span>--ciphertext-blob<span class=w> </span>fileb://ExampleSecretFileEncrypted<span class=w>   </span>--output<span class=w> </span>text<span class=w> </span>--query<span class=w> </span>Plaintext<span class=w> </span>&gt;<span class=w> </span>ExampleFileDecrypted.base64<span class=w>  </span>--region<span class=w> </span>eu-west-2
<span class=c1># back to the text version</span>
cat<span class=w> </span>ExampleFileDecrypted.base64<span class=w> </span><span class=p>|</span><span class=w> </span>base64<span class=w> </span>--decode<span class=w> </span>&gt;<span class=w> </span>ExampleFileDecrypted.txt
</code></pre></div> </li> </ul> <p>KMS supports also <strong>Multi-Region Keys</strong>, where primary key from one region is replicated to other regions. The Key ID stays the same. The idea is to be able to encrypt in one region and decrypt in another region. A use case will be to encrypt attribute of a DynamoDB Global Table with the Primary key, and let client, who has access to the replicated key, decrypt the attribute with lower latency.</p> <p><img alt src=../diagrams/kms-dyn-gt.drawio.png width=800></p> <p><strong>Figure 4: DB table encrypted and replicated with Keys</strong></p> <p>The attribute is decrypted only if the client has access to the KMS Key.</p> <ul> <li><a href=https://awscli.amazonaws.com/v2/documentation/api/latest/reference/kms/create-key.html>See AWS kms create-key CLI</a> for examples of creating customer managed keys.</li> </ul> <h3 id=s3-encryption-considerations>S3 encryption considerations<a class=headerlink href=#s3-encryption-considerations title="Permanent link">&para;</a></h3> <p>By default objects encrypted (or not) with SSE-S3 are replicated.</p> <p>With SSE-C, we, as customer, provide the encryption key, so the encrypted objects are not replicated.</p> <p>With SSE-KMS then we need to specify the KMS Key to encrypt the object in target bucket, adapt the KMS policy so the key is accessible in another region, and in the IAM role, be sure the actions <code>kms:Decrypt</code> is enabled for the source key and <code>kms:Encrypt</code> for the target KMS Key.</p> <h3 id=encrypted-ami-sharing-process>Encrypted AMI sharing process<a class=headerlink href=#encrypted-ami-sharing-process title="Permanent link">&para;</a></h3> <ul> <li>AMI in source account is encrypted with KMS Key from source account.</li> <li>AMI image should authorize the Launch permission for the target account.</li> <li>Define IAM role for the target account to use, and share KMS key accesses (DescribeKey, ReEncrypted, CreateGrant, Decrypt) via the role.</li> <li>When launching EC2 instance from this AMI in the target account, it is possible to use a new, local KMS key to re-encrypt the volumes.</li> </ul> <h3 id=system-management-parameter-store><a href=https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html>System management parameter store</a><a class=headerlink href=#system-management-parameter-store title="Permanent link">&para;</a></h3> <p>Managed service, serverless, it is a secure storage for configuration and secrets. This is a key-value storage, with simple SDK for easy integration in application code. </p> <p><img alt src=../images/security/ssm-parameter.png></p> <ul> <li> <p>SSM Parameter Store has built-in version tracking capability. Each time we edit the value of a parameter, SSM Parameter Store creates a new version of the parameter and retains the previous versions.</p> </li> <li> <p>It is using KMS for seamless encryption. The security access control is via IAM and notifications can be propagated to EventBridge for routing. </p> </li> <li> <p>It stores data in a hierarchical tree. For example </p> <div class=highlight><pre><span></span><code>aws<span class=w> </span>ssm<span class=w> </span>get-parameters-by-path<span class=w> </span>--path<span class=w> </span>/an-app/dev/
</code></pre></div> </li> <li> <p>It is integration with CloudFormation and be used to keep application parameters. </p> </li> <li><a href=https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-paramstore-walk.html>Parameter store walkthroughs.</a></li> <li><a href=https://docs.quarkiverse.io/quarkus-amazon-services/dev/amazon-ssm.html>Quarkus app to access SSM parameter store with Java SDK</a>.</li> </ul> <h3 id=amazon-macie><a href=https://docs.aws.amazon.com/macie/latest/user/what-is-macie.html>Amazon Macie</a><a class=headerlink href=#amazon-macie title="Permanent link">&para;</a></h3> <p>Amazon Macie is a fully managed data security service that uses Machine Learning to discover and protect our sensitive data stored in S3 buckets. It automatically provides an inventory of S3 buckets including a list of unencrypted buckets, publicly accessible buckets, and buckets shared with other AWS accounts. It allows us to identify and alert us to sensitive data, such as Personally Identifiable Information (PII).</p> <p>All Macie findings are sent to Amazon EventBridge and can also be published to AWS Security Hub to initiate automated remediation such as blocking public access to our S3 storage.</p> <ul> <li>Multi account support, integrated with AWS Organization</li> <li>Automated sensitive data discovery</li> <li>Can run scan jobs</li> <li>Scan 1% of content in buckets $1 per GB for first 50TB/ month.</li> </ul> <h3 id=secrets-manager><a href=https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html>Secrets Manager</a><a class=headerlink href=#secrets-manager title="Permanent link">&para;</a></h3> <p>Keep Secret information (unique key-value, or JSON doc), with automatic rotation enforced, and integration with RDS, Redshift, ECS Task, DocumentDB.... Secrets can be replicated between regions. They are encrypted, and keys are in KMS and can be a customer managed key.</p> <p>Secret has metadata like ARN of the key used. SM keeps version of the secrets .When user changes the secret value, or the secret is rotated, Secrets Manager creates a new version.</p> <p>When Secrets Manager rotates a secret, it updates the credentials in both the secret and the database or service. The <strong>Single user</strong> <a href=https://docs.aws.amazon.com/secretsmanager/latest/userguide/getting-started.html#rotation-strategy>rotation strategy</a> updates credentials for one user in one secret. The <strong>alternating users</strong>v strategy updates credentials for two users in one secret. We create the first user, and during the first rotation, the rotation function clones it to create the second user. Every time the secret rotates, the rotation function alternates which user's password it updates.</p> <p>See <a href=https://docs.aws.amazon.com/secretsmanager/latest/userguide/tutorials.html>product tutorials</a>.</p> <p>We need two IAM roles to manage permission to the Secret. 1/ A role that manages the secrets. 2/ A role that use the credentials at runtime <code>RoleToRetrieveSecretAtRuntime</code>.</p> <p>We can control access to secrets using Resource-based Policy, specially when using cross account. The following diagram illustrates the process for getting cross account access:</p> <p><img alt src=../diagrams/security/secrets-cross-account.drawio.png></p> <p>For ECS task, at boot time, secrets are pulled and set in environment variables accessible to the container within the task.</p> <p>A <a href=https://github.com/jbcodeforce/aws-studies/tree/main/labs/security/secret-game>simple demo of CDK to create secrets and ECS cluster with a Quarkus app accessing the Secrets</a>.</p> <h3 id=acm-certificate-manager><a href=https://docs.aws.amazon.com/acm/latest/userguide/acm-overview.html>ACM - Certificate Manager</a><a class=headerlink href=#acm-certificate-manager title="Permanent link">&para;</a></h3> <p>Manage and deploy TLS certificates. Supports public and private certificates. Automatic renewal.</p> <p>Free of charge for public certificates. </p> <p>Integrated with ELBs, Cloudfront, APIs on API gateway. Cannot use ACM with EC2.</p> <h3 id=aws-cloudhsm>AWS <a href="https://aws.amazon.com/cloudhsm/?nc2=type_a">CloudHSM</a><a class=headerlink href=#aws-cloudhsm title="Permanent link">&para;</a></h3> <p><a href=https://docs.aws.amazon.com/cloudhsm/latest/userguide/introduction.html>AWS CloudHSM</a> (Hardware Security Module) helps meet corporate, contractual, and regulatory compliance requirements for data security.</p> <p>HSM provides secure key storage and cryptographic operations within a tamper-resistant hardware device. HSMs are designed to securely store cryptographic key material and use the key material without exposing it outside the cryptographic boundary of the hardware.</p> <p>We can create a cluster that has from 1 to 28 HSMs (the default limit is 6 HSMs per AWS account per AWS Region).</p> <p><img alt src=https://docs.aws.amazon.com/images/cloudhsm/latest/userguide/images/cluster-architecture.png></p> <p>Example of use case is when hosted on EC2, must encrypt the data before writing the data to a storage.</p> <p>We can also use AWS KMS if we need to encrypt data before writing to storage when an AWS managed hardware security module for the cryptographic keys is not required.</p> <hr> <h2 id=3-network-and-app-protection>3- Network and App Protection<a class=headerlink href=#3-network-and-app-protection title="Permanent link">&para;</a></h2> <h3 id=waf-web-application-firewall><a href=https://docs.aws.amazon.com/waf/latest/developerguide/waf-chapter.html>WAF Web Application Firewall</a><a class=headerlink href=#waf-web-application-firewall title="Permanent link">&para;</a></h3> <ul> <li>Used to monitor the HTTP(S) requests that are forwarded to the protected (Layer 7) web application resources.</li> <li> <p>It is deployed on ALB, API Gateway, CloudFront, AppSync GraphQL API, Cognito User Pool.</p> </li> <li> <p>Rules are defined in Web Access Control List: they can apply to IP@, HTTP headers, body, URI strings, SQL injection, Cross-site Scripting...</p> </li> <li>We can define size constraints, geographic matches, or rate-based rules for DDoS protection. For example we can implement a rule capable of blocking all IPs that have more than 2,000 requests in the last 5 minute interval.</li> <li>It provides real-time metrics and captures raw requests that include details about IP addresses, geo locations, URIs, User-Agent and Referers.</li> <li>Rules can be combined into WebACL to define action for each rule. WebACL is regional, except for CloudFront.</li> <li>Can add custom HTTP header to validate the requests.</li> <li>Charges based on the number of Web ACLs</li> </ul> <h4 id=deeper-dive_1>Deeper dive<a class=headerlink href=#deeper-dive_1 title="Permanent link">&para;</a></h4> <ul> <li><a href=https://tutorialsdojo.com/aws-waf/ >Cheat sheet.</a></li> <li><a href=https://docs.aws.amazon.com/waf/latest/developerguide/waf-rule-statement-type-rate-based.html>Rate-based rule statement</a></li> <li><a href=https://aws.amazon.com/waf/faqs/ >WAF FAQ</a></li> </ul> <h3 id=aws-shield><a href=https://aws.amazon.com/shield/ >AWS Shield</a><a class=headerlink href=#aws-shield title="Permanent link">&para;</a></h3> <p>AWS Shield Standard is enabled by default, and free, it provides protection from layer 3 and 4 attacks, like SYN/UDP floods, refection attacks. </p> <p>Shield Advanced is for DDoS attacks. Protects against more sophisticated attack on Amazon EC2, Elastic Load Balancing (ELB), Amazon CloudFront, AWS Global Accelerator, Route 53. It supports network and transport layer protections with near real-time visibility into attacks and 24/7 access to Shield Response Team.</p> <details class="- info"> <summary>DDoS</summary> <p>Distributed Denial of Service (DDoS), includes infrastructure and Application attacks. Uses bots to makes calls to servers or applications, so normal users see not responsive server. AWS Shield standard and Advanced protect against DDoS.</p> </details> <h3 id=firewall-manager><a href=https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html>Firewall manager</a><a class=headerlink href=#firewall-manager title="Permanent link">&para;</a></h3> <p>Firewall manager simplifies the administration and maintenance tasks across multiple accounts of an AWS Organization and resources for a variety of protections, including AWS WAF, AWS Shield Advanced, Amazon VPC security groups, AWS Network Firewall, and Amazon Route 53 Resolver DNS Firewall.</p> <p>It uses security policy with security rules. Those rules could be:</p> <ul> <li>WAF rules to apply to ALB, API Gateways, CloudFront</li> <li>AWS Shield Advanced to appy to ALB, CLB, NLB, Elastic IP, CloudFront</li> <li>To standardize on Security group for EC2, ALB, ENI in VPC</li> <li>AWS Network Firewall, VPC level rules.</li> <li>Rules are defined at the Region level.</li> </ul> <details class="- info"> <summary>WAF vs. Firewall Manager vs. Shield</summary> <p>WAF, Shield and Firewall Manager are used together for comprehensive protection. Start by defining Web ACL rules in WAF. When we need one resource at a time protection then WAF alone is the correct choice. If we want to use AWS WAF across accounts, accelerate WAF configuration, automate the protection of new resources, use Firewall Manager with AWS WAF. Shield Advanced adds additional features on top of AWS WAF, such as dedicated support from the Shield ResponseTeam (SRT) and advanced reporting. If weâ€™re prone to frequent DDoS attacks, consider purchasing Shield Advanced.</p> </details> <hr> <h2 id=4-threat-detection-monitoring>4 - Threat Detection &amp; monitoring<a class=headerlink href=#4-threat-detection-monitoring title="Permanent link">&para;</a></h2> <h3 id=aws-security-hub><a href=https://docs.aws.amazon.com/securityhub/latest/userguide/what-is-securityhub.html>AWS Security Hub</a><a class=headerlink href=#aws-security-hub title="Permanent link">&para;</a></h3> <p>AWS Security Hub is a Cloud Security Posture Management service that performs security best practice checks, aggregates alerts, and enables automated remediation.</p> <p>AWS Security Hub is a single place to view all our security alerts from services like Amazon GuardDuty, Amazon Inspector, Amazon Macie, and AWS Firewall Manager. It is not used for producing audit reports.</p> <h3 id=amazon-guardduty><a href=https://docs.aws.amazon.com/guardduty/latest/ug/what-is-guardduty.html>Amazon GuardDuty</a><a class=headerlink href=#amazon-guardduty title="Permanent link">&para;</a></h3> <p>Amazon GuardDuty is a threat detection service that continuously monitors for malicious activity and unauthorized behavior to protect the AWS accounts, workloads, and data stored in Amazon S3.</p> <p>Security monitoring service that analyzes and processes data sources such as:</p> <ul> <li>AWS CloudTrail event logs: to track unusual API calls, unauthorized deployments, or S3 data events for get object, list object... </li> <li>CloudTrail management event logs, </li> <li>DNS logs: compromized EC2 instances sending encoded data with DNS queries...</li> <li>Amazon EBS volume data, </li> <li>Kubernetes audit logs, </li> <li>Amazon VPC Flow Logs, to track unusual internal traffic.</li> <li>RDS login activity</li> </ul> <p>It uses ML/AI model, anomaly detection, and integrated threat intelligence to identify and prioritize potential threats..</p> <p>GuardDuty can detect compromised EC2 instances and container workloads serving malware, or mining crypto currency.</p> <p>By integrating with Amazon EventBridge Events, GuardDuty alerts are actionable, easy to aggregate across multiple accounts, and straightforward to push into existing event management and workflow systems.</p> <h3 id=amazon-detective><a href=https://aws.amazon.com/detective/ >Amazon Detective</a><a class=headerlink href=#amazon-detective title="Permanent link">&para;</a></h3> <p>When security findings coming from tools like GuardDuty, Macie, or Security Hub, require deeper analysis to isolate the root cause and take action, Amazon Detective can be used.</p> <p>Detective collects logs (VPC Flow logs, CloudTrail, GuardDuty) data from our AWS resources and uses machine learning, statistical analysis, and graph theory for security investigations.</p> <ul> <li><a href=https://tutorialsdojo.com/amazon-detective/ >Cheat sheet.</a></li> <li><a href=https://aws.amazon.com/detective/faqs/ >FAQs</a></li> </ul> <h3 id=amazon-inspector><a href=https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html>Amazon Inspector</a><a class=headerlink href=#amazon-inspector title="Permanent link">&para;</a></h3> <p>Vulnerability management service that continuously scans our AWS workloads for software vulnerabilities and unintended network exposure. Includes <strong>EC2</strong> instance scan and <strong>container images</strong> in Amazon ECR when pushed to the registry, and the same for <strong>Lambda</strong> function.</p> <p>It uses a database of CVE vulnerabilities.</p> <p>The reports are sent to Security Hub and to EventBridge.</p> <hr> <h2 id=privacy-and-compliance>Privacy and Compliance<a class=headerlink href=#privacy-and-compliance title="Permanent link">&para;</a></h2> <h3 id=aws-audit-manager><a href=https://docs.aws.amazon.com/audit-manager/latest/userguide/what-is.html>AWS Audit Manager</a><a class=headerlink href=#aws-audit-manager title="Permanent link">&para;</a></h3> <p>AWS Audit Manager is an automated service to continually audit our AWS usage to simplify how we manage risk and compliance with regulations and industry standards. It eifjcbfdjifhurnicntgjklgrihfkfcdfierkgkghcdi produces reports specific to auditors for PCI compliance, GDPR, and more.</p> <h2 id=aws-cloudtrail><a href=https://aws.amazon.com/cloudtrail/ >AWS CloudTrail</a><a class=headerlink href=#aws-cloudtrail title="Permanent link">&para;</a></h2> <ul> <li>Provides governance, compliance and audit for any AWS account. It is enable by defaults</li> <li>Track all the API calls made within an AWS account. This includes SDK, CLI, Console and IAM roles and users.</li> <li>A trail can be applied to all regions or a single region. </li> <li>Helpful to assess who deleted a resource. </li> <li>The events can be sent to CloudWatch logs, EventBridge, a S3 bucket.</li> <li> <p>Different events tracked:</p> <ul> <li>Management Events: related to resources within our account. Read and write events can be separated.</li> <li>Data Events: not logged by defaults. Example: S3 object activities, lambda execution activities</li> <li>Insights Events: to detect unusual activity in our account: hitting service limits, bursts on IAM actions, gaps in periodic maintenance... It use normal behavior to create a baseline, and then continuously analyzes write events.</li> <li>Retention is for 90 days. For longer retention saved to S3 and then query with Athena.</li> </ul> </li> </ul> <hr> <h2 id=security-faqs>Security FAQs<a class=headerlink href=#security-faqs title="Permanent link">&para;</a></h2> <details class="- question"> <summary>Sensitive data in the cloud can be accessed by everyone</summary> <p>AWS storage managed services are secured by default. We control who can access the data. For example, in S3 bucket, objects, by default, are only available by the owner who created them. IAM policies define access to buckets, and in S3 itself we can define policies. Some policies can be defined at the Account level to forbid to define public bucket. From detection services like <code>CloudTrail</code> and <code>CloudWatch Events</code> we can route events to security team or respond in real-time to those events with code in a Lambda function.</p> </details> <details class="- question"> <summary>Integrate with existing Directory?</summary> <p>IAM can integrate with an existing directory where we can map IAM groups to directory group membership. We can also set up a Federation proxy or an Identity provider, and use AWS Security Token Service to generate temporary tokens so that users in the LDAP can access S3 bucket for example. Note that IAM roles &amp; IAM policy need to be defined to access the bucket.</p> </details> <details class="- question"> <summary>Running intrusion/penetration testing and vulnerability scan</summary> <p>We can run any of those tests on our own workloads and for the following services:</p> <ul> <li>Amazon EC2 instances</li> <li>NAT Gateways</li> <li>Elastic Load Balancers</li> <li>Amazon RDS</li> <li>Amazon CloudFront</li> <li>Amazon Aurora</li> <li>Amazon API Gateways</li> <li>AWS Fargate</li> <li>AWS Lambda and Lambda Edge functions</li> <li>Amazon Lightsail resources</li> <li>Amazon Elastic Beanstalk environments</li> </ul> <p>We need to sign a "Seek approval" document so AWS can understand what we are doing and is not searching for malicious activities on our account or triggers security alarms. To integrate Penetration tests in our CI/CD <a href=https://aws.amazon.com/inspector>Amazon Inspector</a> is an automated vulnerability management service that continually scans AWS workloads for software vulnerabilities and unintended network exposure.</p> </details> <details class="- question"> <summary>How to ensure RDS database can only be accessed using profile credentials specific to EC2 instance?</summary> <p>IAM has <a href=https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAMDBAuth.html>database authentication capabilities</a> that would allow an RDS database to only be accessed using the profile credentials specific to the EC2 instances.</p> </details> <details class="- question"> <summary>Specifics business oriented accreditations</summary> <p>The workload is certified by a 3nd party auditor. AWS provides the accreditation doc for infrastructure and hosting operations. We have full visibility into the logical infrastructure via API calls, so the auditors can get information on items like security group (firewall) rules or RDS configuration via API calls, or account access information through our API auditing service, <code>CloudTrail</code>.</p> </details> <details class="- question"> <summary>How does IDS/IPS works on AWS?</summary> <p>Intrusion Detection and Prevention can be achieved in number of ways: <code>Guard Duty</code>, 3<sup>rd</sup> party solution (AWS marketplace) as well architecture best practices. Amazon VPC traffic mirroring is a â€œvirtual fiber tapâ€ that gives us direct access to the network packets flowing through the VPC.</p> </details> <details class="- question"> <summary>Encrypted traffic between instances?</summary> <p>Within the AWS network, traffic between our instances stay within our VPC. Other customers cannot see our traffic. Configuring inter-instance traffic encryption would be the same as on-premises.</p> </details> <details class="- question"> <summary>Does AWS provide DDoS protection?</summary> <p><a href=https://aws.amazon.com/shield/ >AWS Shield Standard</a> is automically provided to all AWS customers and AWS Shield advanced service can be bought for additional features. AWS Shield is a managed Distributed Denial of Service events protection service that safeguards applications running on AWS.</p> </details> <details class="- question"> <summary>How to be sure data is really deleted</summary> <p>We own the data inside AWS. But on delete operation the data is destroyed and wiped out. When destroying physical hardware, AWS follows the NIST 888 requirements, and it is done in a secure zone in the data center. Audits are done by 3nd party vendor, and compliances are reported in <a href=https://aws.amazon.com/artifact>Artifact</a>.</p> </details> <details class="- question"> <summary>Is serverless secured?</summary> <p>Roles are used to define who can push code, access it, and fine grained control can be define for the serverless execution. All serverless managed services inherit from the underlying platform security control. As an example, Lambda execution are authenticated, authorized and are made visible to the SREs via the common logging mechanism.</p> </details> <details class="- question"> <summary>EC2 to access RDS MySQL</summary> <p>Create an outbound rule in the SG for the EC2 using TCP on port 3306 and the destination to be the SGP of RDS Create an inbound rule in the SG of RDS to allow TCP on port 3306 with source being the EC2's SG. There is no need to specify outbound rule for RDS, as security groups are stateful therefore the response from the DB servers would be allowed out of the DB servers.</p> </details> <h2 id=solution-design>Solution Design<a class=headerlink href=#solution-design title="Permanent link">&para;</a></h2> <p>The most important questions to ask and address when designing AWS solution with security consideration are:</p> <ul> <li>who can access the resources in the account?</li> <li>what can access the resources, and how access is allowed?</li> </ul> <p>Address how to secure, web tier, app tier and database access. What firewalls to use, and where.</p> <p>For each compute resource, address access to monitoring and logging and network environment that contain those resources.</p> <p>Is there any Gateway needed?</p> <p>Finally consider data life cycle and access control over time. What are the compliance requirements? </p> <h3 id=blocking-ip-address>Blocking IP address<a class=headerlink href=#blocking-ip-address title="Permanent link">&para;</a></h3> <ul> <li> <p>At the VPC level, the best approach is to use Network ACL, when EC2 is exposed via public IP address, as illustrasted in the diagram below:</p> <p><img alt src=../diagrams/security/sa-sol-1.drawio.png></p> <p>Use a denial rule in <a href=../networking/#network-acls>NACL</a> for a specific IP address. Security group inbound rule specifies allowed only IP range (no deny rule), which should work, but then it blocks larger set of clients, so it will not be a solution for global application. Running a firewall on the EC2 will help, but it is more complex to administer. </p> </li> <li> <p>If an ALB is added in the middle, then the EC2 security group will specify the Security Group of the ALB, and we are still using NACL:</p> <p><img alt src=../diagrams/security/sa-sol-2.drawio.png></p> <p>ALB does connection termination, so client will not be able to attack EC2. ALB initiates a new connection to EC2.</p> <p>To add more control we can add a Web Application Firewall to add complex filtering on the IP @.</p> </li> <li> <p>Using a NLB, there will be no security group at the network load balancer level, so traffic reaches EC2s. In this case only the NACL rules will help to protect.</p> </li> <li> <p>When using CloudFront (outside of VPC), we need to add WAF, as NACL at the VPC level will not work, the ALB being connected to the CloudFront public IP address (via security group).</p> <p><img alt src=../diagrams/security/sa-sol-3.drawio.png></p> <p>Geo restriction can be defined at the CloudFront level, to deny a complete country for example.</p> </li> </ul> <h2 id=security-learn-more>Security Learn more<a class=headerlink href=#security-learn-more title="Permanent link">&para;</a></h2> <ul> <li><a href=https://aws.amazon.com/campaigns/cloud-security/data-safe-cloud-checklist/ >Data Safe cloud checklist</a></li> <li><a href="https://www.youtube.com/watch?v=MxDO78BYsU0">Top security myth - dispelled</a></li> <li><a href=../../playground/security/ >Security demos</a></li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../networking/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Networking"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Networking </div> </div> </a> <a href=../storage/ class="md-footer__link md-footer__link--next" aria-label="Next: S3-Storage"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> S3-Storage </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.code.copy", "content.tooltips", "navigation.instant", "navigation.tracking", "navigation.footer", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.af256bd8.min.js></script> </body> </html>